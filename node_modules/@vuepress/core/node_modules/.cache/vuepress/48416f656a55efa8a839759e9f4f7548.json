{"remainingRequest":"/Users/mengyu/vuepress-starter/vuepress-starter/node_modules/babel-loader/lib/index.js??ref--3-1!/Users/mengyu/vuepress-starter/vuepress-starter/node_modules/vue-i18n/dist/vue-i18n.esm.js","dependencies":[{"path":"/Users/mengyu/vuepress-starter/vuepress-starter/node_modules/vue-i18n/dist/vue-i18n.esm.js","mtime":1661659639454},{"path":"/Users/mengyu/vuepress-starter/vuepress-starter/node_modules/cache-loader/dist/cjs.js","mtime":1661658709451},{"path":"/Users/mengyu/vuepress-starter/vuepress-starter/node_modules/babel-loader/lib/index.js","mtime":1661658709446}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucmVkdWNlLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZXJyb3IuY2F1c2UuanMiOwoKLyohCiAqIHZ1ZS1pMThuIHY4LjI3LjIgCiAqIChjKSAyMDIyIGthenV5YSBrYXdhZ3VjaGkKICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBMaWNlbnNlLgogKi8KCi8qICAqLwoKLyoqCiAqIGNvbnN0YW50cwogKi8KdmFyIG51bWJlckZvcm1hdEtleXMgPSBbJ2NvbXBhY3REaXNwbGF5JywgJ2N1cnJlbmN5JywgJ2N1cnJlbmN5RGlzcGxheScsICdjdXJyZW5jeVNpZ24nLCAnbG9jYWxlTWF0Y2hlcicsICdub3RhdGlvbicsICdudW1iZXJpbmdTeXN0ZW0nLCAnc2lnbkRpc3BsYXknLCAnc3R5bGUnLCAndW5pdCcsICd1bml0RGlzcGxheScsICd1c2VHcm91cGluZycsICdtaW5pbXVtSW50ZWdlckRpZ2l0cycsICdtaW5pbXVtRnJhY3Rpb25EaWdpdHMnLCAnbWF4aW11bUZyYWN0aW9uRGlnaXRzJywgJ21pbmltdW1TaWduaWZpY2FudERpZ2l0cycsICdtYXhpbXVtU2lnbmlmaWNhbnREaWdpdHMnXTsKLyoqCiAqIHV0aWxpdGllcwogKi8KCmZ1bmN0aW9uIHdhcm4obXNnLCBlcnIpIHsKICBpZiAodHlwZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnKSB7CiAgICBjb25zb2xlLndhcm4oJ1t2dWUtaTE4bl0gJyArIG1zZyk7CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KCiAgICBpZiAoZXJyKSB7CiAgICAgIGNvbnNvbGUud2FybihlcnIuc3RhY2spOwogICAgfQogIH0KfQoKZnVuY3Rpb24gZXJyb3IobXNnLCBlcnIpIHsKICBpZiAodHlwZW9mIGNvbnNvbGUgIT09ICd1bmRlZmluZWQnKSB7CiAgICBjb25zb2xlLmVycm9yKCdbdnVlLWkxOG5dICcgKyBtc2cpOwogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCgogICAgaWYgKGVycikgewogICAgICBjb25zb2xlLmVycm9yKGVyci5zdGFjayk7CiAgICB9CiAgfQp9Cgp2YXIgaXNBcnJheSA9IEFycmF5LmlzQXJyYXk7CgpmdW5jdGlvbiBpc09iamVjdChvYmopIHsKICByZXR1cm4gb2JqICE9PSBudWxsICYmIHR5cGVvZiBvYmogPT09ICdvYmplY3QnOwp9CgpmdW5jdGlvbiBpc0Jvb2xlYW4odmFsKSB7CiAgcmV0dXJuIHR5cGVvZiB2YWwgPT09ICdib29sZWFuJzsKfQoKZnVuY3Rpb24gaXNTdHJpbmcodmFsKSB7CiAgcmV0dXJuIHR5cGVvZiB2YWwgPT09ICdzdHJpbmcnOwp9Cgp2YXIgdG9TdHJpbmcgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nOwp2YXIgT0JKRUNUX1NUUklORyA9ICdbb2JqZWN0IE9iamVjdF0nOwoKZnVuY3Rpb24gaXNQbGFpbk9iamVjdChvYmopIHsKICByZXR1cm4gdG9TdHJpbmcuY2FsbChvYmopID09PSBPQkpFQ1RfU1RSSU5HOwp9CgpmdW5jdGlvbiBpc051bGwodmFsKSB7CiAgcmV0dXJuIHZhbCA9PT0gbnVsbCB8fCB2YWwgPT09IHVuZGVmaW5lZDsKfQoKZnVuY3Rpb24gaXNGdW5jdGlvbih2YWwpIHsKICByZXR1cm4gdHlwZW9mIHZhbCA9PT0gJ2Z1bmN0aW9uJzsKfQoKZnVuY3Rpb24gcGFyc2VBcmdzKCkgewogIHZhciBhcmdzID0gW10sCiAgICAgIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7CgogIHdoaWxlIChsZW4tLSkgYXJnc1tsZW5dID0gYXJndW1lbnRzW2xlbl07CgogIHZhciBsb2NhbGUgPSBudWxsOwogIHZhciBwYXJhbXMgPSBudWxsOwoKICBpZiAoYXJncy5sZW5ndGggPT09IDEpIHsKICAgIGlmIChpc09iamVjdChhcmdzWzBdKSB8fCBpc0FycmF5KGFyZ3NbMF0pKSB7CiAgICAgIHBhcmFtcyA9IGFyZ3NbMF07CiAgICB9IGVsc2UgaWYgKHR5cGVvZiBhcmdzWzBdID09PSAnc3RyaW5nJykgewogICAgICBsb2NhbGUgPSBhcmdzWzBdOwogICAgfQogIH0gZWxzZSBpZiAoYXJncy5sZW5ndGggPT09IDIpIHsKICAgIGlmICh0eXBlb2YgYXJnc1swXSA9PT0gJ3N0cmluZycpIHsKICAgICAgbG9jYWxlID0gYXJnc1swXTsKICAgIH0KICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwoKCiAgICBpZiAoaXNPYmplY3QoYXJnc1sxXSkgfHwgaXNBcnJheShhcmdzWzFdKSkgewogICAgICBwYXJhbXMgPSBhcmdzWzFdOwogICAgfQogIH0KCiAgcmV0dXJuIHsKICAgIGxvY2FsZTogbG9jYWxlLAogICAgcGFyYW1zOiBwYXJhbXMKICB9Owp9CgpmdW5jdGlvbiBsb29zZUNsb25lKG9iaikgewogIHJldHVybiBKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KG9iaikpOwp9CgpmdW5jdGlvbiByZW1vdmUoYXJyLCBpdGVtKSB7CiAgaWYgKGFyci5kZWxldGUoaXRlbSkpIHsKICAgIHJldHVybiBhcnI7CiAgfQp9CgpmdW5jdGlvbiBhcnJheUZyb20oYXJyKSB7CiAgdmFyIHJldCA9IFtdOwogIGFyci5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7CiAgICByZXR1cm4gcmV0LnB1c2goYSk7CiAgfSk7CiAgcmV0dXJuIHJldDsKfQoKZnVuY3Rpb24gaW5jbHVkZXMoYXJyLCBpdGVtKSB7CiAgcmV0dXJuICEhfmFyci5pbmRleE9mKGl0ZW0pOwp9Cgp2YXIgaGFzT3duUHJvcGVydHkgPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5OwoKZnVuY3Rpb24gaGFzT3duKG9iaiwga2V5KSB7CiAgcmV0dXJuIGhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpOwp9CgpmdW5jdGlvbiBtZXJnZSh0YXJnZXQpIHsKICB2YXIgYXJndW1lbnRzJDEgPSBhcmd1bWVudHM7CiAgdmFyIG91dHB1dCA9IE9iamVjdCh0YXJnZXQpOwoKICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50cyQxW2ldOwoKICAgIGlmIChzb3VyY2UgIT09IHVuZGVmaW5lZCAmJiBzb3VyY2UgIT09IG51bGwpIHsKICAgICAgdmFyIGtleSA9IHZvaWQgMDsKCiAgICAgIGZvciAoa2V5IGluIHNvdXJjZSkgewogICAgICAgIGlmIChoYXNPd24oc291cmNlLCBrZXkpKSB7CiAgICAgICAgICBpZiAoaXNPYmplY3Qoc291cmNlW2tleV0pKSB7CiAgICAgICAgICAgIG91dHB1dFtrZXldID0gbWVyZ2Uob3V0cHV0W2tleV0sIHNvdXJjZVtrZXldKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG91dHB1dFtrZXldID0gc291cmNlW2tleV07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQoKICByZXR1cm4gb3V0cHV0Owp9CgpmdW5jdGlvbiBsb29zZUVxdWFsKGEsIGIpIHsKICBpZiAoYSA9PT0gYikgewogICAgcmV0dXJuIHRydWU7CiAgfQoKICB2YXIgaXNPYmplY3RBID0gaXNPYmplY3QoYSk7CiAgdmFyIGlzT2JqZWN0QiA9IGlzT2JqZWN0KGIpOwoKICBpZiAoaXNPYmplY3RBICYmIGlzT2JqZWN0QikgewogICAgdHJ5IHsKICAgICAgdmFyIGlzQXJyYXlBID0gaXNBcnJheShhKTsKICAgICAgdmFyIGlzQXJyYXlCID0gaXNBcnJheShiKTsKCiAgICAgIGlmIChpc0FycmF5QSAmJiBpc0FycmF5QikgewogICAgICAgIHJldHVybiBhLmxlbmd0aCA9PT0gYi5sZW5ndGggJiYgYS5ldmVyeShmdW5jdGlvbiAoZSwgaSkgewogICAgICAgICAgcmV0dXJuIGxvb3NlRXF1YWwoZSwgYltpXSk7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSBpZiAoIWlzQXJyYXlBICYmICFpc0FycmF5QikgewogICAgICAgIHZhciBrZXlzQSA9IE9iamVjdC5rZXlzKGEpOwogICAgICAgIHZhciBrZXlzQiA9IE9iamVjdC5rZXlzKGIpOwogICAgICAgIHJldHVybiBrZXlzQS5sZW5ndGggPT09IGtleXNCLmxlbmd0aCAmJiBrZXlzQS5ldmVyeShmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgICByZXR1cm4gbG9vc2VFcXVhbChhW2tleV0sIGJba2V5XSk7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH0gZWxzZSBpZiAoIWlzT2JqZWN0QSAmJiAhaXNPYmplY3RCKSB7CiAgICByZXR1cm4gU3RyaW5nKGEpID09PSBTdHJpbmcoYik7CiAgfSBlbHNlIHsKICAgIHJldHVybiBmYWxzZTsKICB9Cn0KLyoqCiAqIFNhbml0aXplcyBodG1sIHNwZWNpYWwgY2hhcmFjdGVycyBmcm9tIGlucHV0IHN0cmluZ3MuIEZvciBtaXRpZ2F0aW5nIHJpc2sgb2YgWFNTIGF0dGFja3MuCiAqIEBwYXJhbSByYXdUZXh0IFRoZSByYXcgaW5wdXQgZnJvbSB0aGUgdXNlciB0aGF0IHNob3VsZCBiZSBlc2NhcGVkLgogKi8KCgpmdW5jdGlvbiBlc2NhcGVIdG1sKHJhd1RleHQpIHsKICByZXR1cm4gcmF3VGV4dC5yZXBsYWNlKC88L2csICcmbHQ7JykucmVwbGFjZSgvPi9nLCAnJmd0OycpLnJlcGxhY2UoLyIvZywgJyZxdW90OycpLnJlcGxhY2UoLycvZywgJyZhcG9zOycpOwp9Ci8qKgogKiBFc2NhcGVzIGh0bWwgdGFncyBhbmQgc3BlY2lhbCBzeW1ib2xzIGZyb20gYWxsIHByb3ZpZGVkIHBhcmFtcyB3aGljaCB3ZXJlIHJldHVybmVkIGZyb20gcGFyc2VBcmdzKCkucGFyYW1zLgogKiBUaGlzIG1ldGhvZCBwZXJmb3JtcyBhbiBpbi1wbGFjZSBvcGVyYXRpb24gb24gdGhlIHBhcmFtcyBvYmplY3QuCiAqCiAqIEBwYXJhbSB7YW55fSBwYXJhbXMgUGFyYW1ldGVycyBhcyBwcm92aWRlZCBmcm9tIGBwYXJzZUFyZ3MoKS5wYXJhbXNgLgogKiAgICAgICAgICAgICAgICAgICAgIE1heSBiZSBlaXRoZXIgYW4gYXJyYXkgb2Ygc3RyaW5ncyBvciBhIHN0cmluZy0+YW55IG1hcC4KICoKICogQHJldHVybnMgVGhlIG1hbmlwdWxhdGVkIGBwYXJhbXNgIG9iamVjdC4KICovCgoKZnVuY3Rpb24gZXNjYXBlUGFyYW1zKHBhcmFtcykgewogIGlmIChwYXJhbXMgIT0gbnVsbCkgewogICAgT2JqZWN0LmtleXMocGFyYW1zKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgaWYgKHR5cGVvZiBwYXJhbXNba2V5XSA9PSAnc3RyaW5nJykgewogICAgICAgIHBhcmFtc1trZXldID0gZXNjYXBlSHRtbChwYXJhbXNba2V5XSk7CiAgICAgIH0KICAgIH0pOwogIH0KCiAgcmV0dXJuIHBhcmFtczsKfQovKiAgKi8KCgpmdW5jdGlvbiBleHRlbmQoVnVlKSB7CiAgaWYgKCFWdWUucHJvdG90eXBlLmhhc093blByb3BlcnR5KCckaTE4bicpKSB7CiAgICAvLyAkRmxvd0ZpeE1lCiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoVnVlLnByb3RvdHlwZSwgJyRpMThuJywgewogICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICByZXR1cm4gdGhpcy5faTE4bjsKICAgICAgfQogICAgfSk7CiAgfQoKICBWdWUucHJvdG90eXBlLiR0ID0gZnVuY3Rpb24gKGtleSkgewogICAgdmFyIHZhbHVlcyA9IFtdLAogICAgICAgIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGggLSAxOwoKICAgIHdoaWxlIChsZW4tLSA+IDApIHZhbHVlc1tsZW5dID0gYXJndW1lbnRzW2xlbiArIDFdOwoKICAgIHZhciBpMThuID0gdGhpcy4kaTE4bjsKICAgIHJldHVybiBpMThuLl90LmFwcGx5KGkxOG4sIFtrZXksIGkxOG4ubG9jYWxlLCBpMThuLl9nZXRNZXNzYWdlcygpLCB0aGlzXS5jb25jYXQodmFsdWVzKSk7CiAgfTsKCiAgVnVlLnByb3RvdHlwZS4kdGMgPSBmdW5jdGlvbiAoa2V5LCBjaG9pY2UpIHsKICAgIHZhciB2YWx1ZXMgPSBbXSwKICAgICAgICBsZW4gPSBhcmd1bWVudHMubGVuZ3RoIC0gMjsKCiAgICB3aGlsZSAobGVuLS0gPiAwKSB2YWx1ZXNbbGVuXSA9IGFyZ3VtZW50c1tsZW4gKyAyXTsKCiAgICB2YXIgaTE4biA9IHRoaXMuJGkxOG47CiAgICByZXR1cm4gaTE4bi5fdGMuYXBwbHkoaTE4biwgW2tleSwgaTE4bi5sb2NhbGUsIGkxOG4uX2dldE1lc3NhZ2VzKCksIHRoaXMsIGNob2ljZV0uY29uY2F0KHZhbHVlcykpOwogIH07CgogIFZ1ZS5wcm90b3R5cGUuJHRlID0gZnVuY3Rpb24gKGtleSwgbG9jYWxlKSB7CiAgICB2YXIgaTE4biA9IHRoaXMuJGkxOG47CiAgICByZXR1cm4gaTE4bi5fdGUoa2V5LCBpMThuLmxvY2FsZSwgaTE4bi5fZ2V0TWVzc2FnZXMoKSwgbG9jYWxlKTsKICB9OwoKICBWdWUucHJvdG90eXBlLiRkID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICB2YXIgcmVmOwogICAgdmFyIGFyZ3MgPSBbXSwKICAgICAgICBsZW4gPSBhcmd1bWVudHMubGVuZ3RoIC0gMTsKCiAgICB3aGlsZSAobGVuLS0gPiAwKSBhcmdzW2xlbl0gPSBhcmd1bWVudHNbbGVuICsgMV07CgogICAgcmV0dXJuIChyZWYgPSB0aGlzLiRpMThuKS5kLmFwcGx5KHJlZiwgW3ZhbHVlXS5jb25jYXQoYXJncykpOwogIH07CgogIFZ1ZS5wcm90b3R5cGUuJG4gPSBmdW5jdGlvbiAodmFsdWUpIHsKICAgIHZhciByZWY7CiAgICB2YXIgYXJncyA9IFtdLAogICAgICAgIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGggLSAxOwoKICAgIHdoaWxlIChsZW4tLSA+IDApIGFyZ3NbbGVuXSA9IGFyZ3VtZW50c1tsZW4gKyAxXTsKCiAgICByZXR1cm4gKHJlZiA9IHRoaXMuJGkxOG4pLm4uYXBwbHkocmVmLCBbdmFsdWVdLmNvbmNhdChhcmdzKSk7CiAgfTsKfQovKiAgKi8KCi8qKgogKiBNaXhpbgogKiAKICogSWYgYGJyaWRnZWAgbW9kZSwgZW1wdHkgbWl4aW4gaXMgcmV0dXJuZWQsCiAqIGVsc2UgcmVndWxhcnkgbWl4aW4gaW1wbGVtZW50YXRpb24gaXMgcmV0dXJuZWQuCiAqLwoKCmZ1bmN0aW9uIGRlZmluZU1peGluKGJyaWRnZSkgewogIGlmIChicmlkZ2UgPT09IHZvaWQgMCkgYnJpZGdlID0gZmFsc2U7CgogIGZ1bmN0aW9uIG1vdW50ZWQoKSB7CiAgICBpZiAodGhpcyAhPT0gdGhpcy4kcm9vdCAmJiB0aGlzLiRvcHRpb25zLl9fSU5UTElGWV9NRVRBX18gJiYgdGhpcy4kZWwpIHsKICAgICAgdGhpcy4kZWwuc2V0QXR0cmlidXRlKCdkYXRhLWludGxpZnknLCB0aGlzLiRvcHRpb25zLl9fSU5UTElGWV9NRVRBX18pOwogICAgfQogIH0KCiAgcmV0dXJuIGJyaWRnZSA/IHsKICAgIG1vdW50ZWQ6IG1vdW50ZWQKICB9IC8vIGRlbGVnYXRlIGB2dWUtaTE4bi1icmlkZ2VgIG1peGluIGltcGxlbWVudGF0aW9uCiAgOiB7CiAgICAvLyByZWd1bGFyeSAKICAgIGJlZm9yZUNyZWF0ZTogZnVuY3Rpb24gYmVmb3JlQ3JlYXRlKCkgewogICAgICB2YXIgb3B0aW9ucyA9IHRoaXMuJG9wdGlvbnM7CiAgICAgIG9wdGlvbnMuaTE4biA9IG9wdGlvbnMuaTE4biB8fCAob3B0aW9ucy5fX2kxOG5CcmlkZ2UgfHwgb3B0aW9ucy5fX2kxOG4gPyB7fSA6IG51bGwpOwoKICAgICAgaWYgKG9wdGlvbnMuaTE4bikgewogICAgICAgIGlmIChvcHRpb25zLmkxOG4gaW5zdGFuY2VvZiBWdWVJMThuKSB7CiAgICAgICAgICAvLyBpbml0IGxvY2FsZSBtZXNzYWdlcyB2aWEgY3VzdG9tIGJsb2NrcwogICAgICAgICAgaWYgKG9wdGlvbnMuX19pMThuQnJpZGdlIHx8IG9wdGlvbnMuX19pMThuKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgdmFyIGxvY2FsZU1lc3NhZ2VzID0gb3B0aW9ucy5pMThuICYmIG9wdGlvbnMuaTE4bi5tZXNzYWdlcyA/IG9wdGlvbnMuaTE4bi5tZXNzYWdlcyA6IHt9OwoKICAgICAgICAgICAgICB2YXIgX2kxOG4gPSBvcHRpb25zLl9faTE4bkJyaWRnZSB8fCBvcHRpb25zLl9faTE4bjsKCiAgICAgICAgICAgICAgX2kxOG4uZm9yRWFjaChmdW5jdGlvbiAocmVzb3VyY2UpIHsKICAgICAgICAgICAgICAgIGxvY2FsZU1lc3NhZ2VzID0gbWVyZ2UobG9jYWxlTWVzc2FnZXMsIEpTT04ucGFyc2UocmVzb3VyY2UpKTsKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgT2JqZWN0LmtleXMobG9jYWxlTWVzc2FnZXMpLmZvckVhY2goZnVuY3Rpb24gKGxvY2FsZSkgewogICAgICAgICAgICAgICAgb3B0aW9ucy5pMThuLm1lcmdlTG9jYWxlTWVzc2FnZShsb2NhbGUsIGxvY2FsZU1lc3NhZ2VzW2xvY2FsZV0pOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHsKICAgICAgICAgICAgICAgIGVycm9yKCJDYW5ub3QgcGFyc2UgbG9jYWxlIG1lc3NhZ2VzIHZpYSBjdXN0b20gYmxvY2tzLiIsIGUpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuX2kxOG4gPSBvcHRpb25zLmkxOG47CiAgICAgICAgICB0aGlzLl9pMThuV2F0Y2hlciA9IHRoaXMuX2kxOG4ud2F0Y2hJMThuRGF0YSgpOwogICAgICAgIH0gZWxzZSBpZiAoaXNQbGFpbk9iamVjdChvcHRpb25zLmkxOG4pKSB7CiAgICAgICAgICB2YXIgcm9vdEkxOG4gPSB0aGlzLiRyb290ICYmIHRoaXMuJHJvb3QuJGkxOG4gJiYgdGhpcy4kcm9vdC4kaTE4biBpbnN0YW5jZW9mIFZ1ZUkxOG4gPyB0aGlzLiRyb290LiRpMThuIDogbnVsbDsgLy8gY29tcG9uZW50IGxvY2FsIGkxOG4KCiAgICAgICAgICBpZiAocm9vdEkxOG4pIHsKICAgICAgICAgICAgb3B0aW9ucy5pMThuLnJvb3QgPSB0aGlzLiRyb290OwogICAgICAgICAgICBvcHRpb25zLmkxOG4uZm9ybWF0dGVyID0gcm9vdEkxOG4uZm9ybWF0dGVyOwogICAgICAgICAgICBvcHRpb25zLmkxOG4uZmFsbGJhY2tMb2NhbGUgPSByb290STE4bi5mYWxsYmFja0xvY2FsZTsKICAgICAgICAgICAgb3B0aW9ucy5pMThuLmZvcm1hdEZhbGxiYWNrTWVzc2FnZXMgPSByb290STE4bi5mb3JtYXRGYWxsYmFja01lc3NhZ2VzOwogICAgICAgICAgICBvcHRpb25zLmkxOG4uc2lsZW50VHJhbnNsYXRpb25XYXJuID0gcm9vdEkxOG4uc2lsZW50VHJhbnNsYXRpb25XYXJuOwogICAgICAgICAgICBvcHRpb25zLmkxOG4uc2lsZW50RmFsbGJhY2tXYXJuID0gcm9vdEkxOG4uc2lsZW50RmFsbGJhY2tXYXJuOwogICAgICAgICAgICBvcHRpb25zLmkxOG4ucGx1cmFsaXphdGlvblJ1bGVzID0gcm9vdEkxOG4ucGx1cmFsaXphdGlvblJ1bGVzOwogICAgICAgICAgICBvcHRpb25zLmkxOG4ucHJlc2VydmVEaXJlY3RpdmVDb250ZW50ID0gcm9vdEkxOG4ucHJlc2VydmVEaXJlY3RpdmVDb250ZW50OwogICAgICAgICAgfSAvLyBpbml0IGxvY2FsZSBtZXNzYWdlcyB2aWEgY3VzdG9tIGJsb2NrcwoKCiAgICAgICAgICBpZiAob3B0aW9ucy5fX2kxOG5CcmlkZ2UgfHwgb3B0aW9ucy5fX2kxOG4pIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICB2YXIgbG9jYWxlTWVzc2FnZXMkMSA9IG9wdGlvbnMuaTE4biAmJiBvcHRpb25zLmkxOG4ubWVzc2FnZXMgPyBvcHRpb25zLmkxOG4ubWVzc2FnZXMgOiB7fTsKCiAgICAgICAgICAgICAgdmFyIF9pMThuJDEgPSBvcHRpb25zLl9faTE4bkJyaWRnZSB8fCBvcHRpb25zLl9faTE4bjsKCiAgICAgICAgICAgICAgX2kxOG4kMS5mb3JFYWNoKGZ1bmN0aW9uIChyZXNvdXJjZSkgewogICAgICAgICAgICAgICAgbG9jYWxlTWVzc2FnZXMkMSA9IG1lcmdlKGxvY2FsZU1lc3NhZ2VzJDEsIEpTT04ucGFyc2UocmVzb3VyY2UpKTsKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgb3B0aW9ucy5pMThuLm1lc3NhZ2VzID0gbG9jYWxlTWVzc2FnZXMkMTsKICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAgICAgICAgICAgICB3YXJuKCJDYW5ub3QgcGFyc2UgbG9jYWxlIG1lc3NhZ2VzIHZpYSBjdXN0b20gYmxvY2tzLiIsIGUpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIHZhciByZWYgPSBvcHRpb25zLmkxOG47CiAgICAgICAgICB2YXIgc2hhcmVkTWVzc2FnZXMgPSByZWYuc2hhcmVkTWVzc2FnZXM7CgogICAgICAgICAgaWYgKHNoYXJlZE1lc3NhZ2VzICYmIGlzUGxhaW5PYmplY3Qoc2hhcmVkTWVzc2FnZXMpKSB7CiAgICAgICAgICAgIG9wdGlvbnMuaTE4bi5tZXNzYWdlcyA9IG1lcmdlKG9wdGlvbnMuaTE4bi5tZXNzYWdlcywgc2hhcmVkTWVzc2FnZXMpOwogICAgICAgICAgfQoKICAgICAgICAgIHRoaXMuX2kxOG4gPSBuZXcgVnVlSTE4bihvcHRpb25zLmkxOG4pOwogICAgICAgICAgdGhpcy5faTE4bldhdGNoZXIgPSB0aGlzLl9pMThuLndhdGNoSTE4bkRhdGEoKTsKCiAgICAgICAgICBpZiAob3B0aW9ucy5pMThuLnN5bmMgPT09IHVuZGVmaW5lZCB8fCAhIW9wdGlvbnMuaTE4bi5zeW5jKSB7CiAgICAgICAgICAgIHRoaXMuX2xvY2FsZVdhdGNoZXIgPSB0aGlzLiRpMThuLndhdGNoTG9jYWxlKCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHJvb3RJMThuKSB7CiAgICAgICAgICAgIHJvb3RJMThuLm9uQ29tcG9uZW50SW5zdGFuY2VDcmVhdGVkKHRoaXMuX2kxOG4pOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgICAgICAgICB3YXJuKCJDYW5ub3QgYmUgaW50ZXJwcmV0ZWQgJ2kxOG4nIG9wdGlvbi4iKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodGhpcy4kcm9vdCAmJiB0aGlzLiRyb290LiRpMThuICYmIHRoaXMuJHJvb3QuJGkxOG4gaW5zdGFuY2VvZiBWdWVJMThuKSB7CiAgICAgICAgLy8gcm9vdCBpMThuCiAgICAgICAgdGhpcy5faTE4biA9IHRoaXMuJHJvb3QuJGkxOG47CiAgICAgIH0gZWxzZSBpZiAob3B0aW9ucy5wYXJlbnQgJiYgb3B0aW9ucy5wYXJlbnQuJGkxOG4gJiYgb3B0aW9ucy5wYXJlbnQuJGkxOG4gaW5zdGFuY2VvZiBWdWVJMThuKSB7CiAgICAgICAgLy8gcGFyZW50IGkxOG4KICAgICAgICB0aGlzLl9pMThuID0gb3B0aW9ucy5wYXJlbnQuJGkxOG47CiAgICAgIH0KICAgIH0sCiAgICBiZWZvcmVNb3VudDogZnVuY3Rpb24gYmVmb3JlTW91bnQoKSB7CiAgICAgIHZhciBvcHRpb25zID0gdGhpcy4kb3B0aW9uczsKICAgICAgb3B0aW9ucy5pMThuID0gb3B0aW9ucy5pMThuIHx8IChvcHRpb25zLl9faTE4bkJyaWRnZSB8fCBvcHRpb25zLl9faTE4biA/IHt9IDogbnVsbCk7CgogICAgICBpZiAob3B0aW9ucy5pMThuKSB7CiAgICAgICAgaWYgKG9wdGlvbnMuaTE4biBpbnN0YW5jZW9mIFZ1ZUkxOG4pIHsKICAgICAgICAgIC8vIGluaXQgbG9jYWxlIG1lc3NhZ2VzIHZpYSBjdXN0b20gYmxvY2tzCiAgICAgICAgICB0aGlzLl9pMThuLnN1YnNjcmliZURhdGFDaGFuZ2luZyh0aGlzKTsKCiAgICAgICAgICB0aGlzLl9zdWJzY3JpYmluZyA9IHRydWU7CiAgICAgICAgfSBlbHNlIGlmIChpc1BsYWluT2JqZWN0KG9wdGlvbnMuaTE4bikpIHsKICAgICAgICAgIHRoaXMuX2kxOG4uc3Vic2NyaWJlRGF0YUNoYW5naW5nKHRoaXMpOwoKICAgICAgICAgIHRoaXMuX3N1YnNjcmliaW5nID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHsKICAgICAgICAgICAgd2FybigiQ2Fubm90IGJlIGludGVycHJldGVkICdpMThuJyBvcHRpb24uIik7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHRoaXMuJHJvb3QgJiYgdGhpcy4kcm9vdC4kaTE4biAmJiB0aGlzLiRyb290LiRpMThuIGluc3RhbmNlb2YgVnVlSTE4bikgewogICAgICAgIHRoaXMuX2kxOG4uc3Vic2NyaWJlRGF0YUNoYW5naW5nKHRoaXMpOwoKICAgICAgICB0aGlzLl9zdWJzY3JpYmluZyA9IHRydWU7CiAgICAgIH0gZWxzZSBpZiAob3B0aW9ucy5wYXJlbnQgJiYgb3B0aW9ucy5wYXJlbnQuJGkxOG4gJiYgb3B0aW9ucy5wYXJlbnQuJGkxOG4gaW5zdGFuY2VvZiBWdWVJMThuKSB7CiAgICAgICAgdGhpcy5faTE4bi5zdWJzY3JpYmVEYXRhQ2hhbmdpbmcodGhpcyk7CgogICAgICAgIHRoaXMuX3N1YnNjcmliaW5nID0gdHJ1ZTsKICAgICAgfQogICAgfSwKICAgIG1vdW50ZWQ6IG1vdW50ZWQsCiAgICBiZWZvcmVEZXN0cm95OiBmdW5jdGlvbiBiZWZvcmVEZXN0cm95KCkgewogICAgICBpZiAoIXRoaXMuX2kxOG4pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgdGhpcy4kbmV4dFRpY2soZnVuY3Rpb24gKCkgewogICAgICAgIGlmIChzZWxmLl9zdWJzY3JpYmluZykgewogICAgICAgICAgc2VsZi5faTE4bi51bnN1YnNjcmliZURhdGFDaGFuZ2luZyhzZWxmKTsKCiAgICAgICAgICBkZWxldGUgc2VsZi5fc3Vic2NyaWJpbmc7CiAgICAgICAgfQoKICAgICAgICBpZiAoc2VsZi5faTE4bldhdGNoZXIpIHsKICAgICAgICAgIHNlbGYuX2kxOG5XYXRjaGVyKCk7CgogICAgICAgICAgc2VsZi5faTE4bi5kZXN0cm95Vk0oKTsKCiAgICAgICAgICBkZWxldGUgc2VsZi5faTE4bldhdGNoZXI7CiAgICAgICAgfQoKICAgICAgICBpZiAoc2VsZi5fbG9jYWxlV2F0Y2hlcikgewogICAgICAgICAgc2VsZi5fbG9jYWxlV2F0Y2hlcigpOwoKICAgICAgICAgIGRlbGV0ZSBzZWxmLl9sb2NhbGVXYXRjaGVyOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfTsKfQovKiAgKi8KCgp2YXIgaW50ZXJwb2xhdGlvbkNvbXBvbmVudCA9IHsKICBuYW1lOiAnaTE4bicsCiAgZnVuY3Rpb25hbDogdHJ1ZSwKICBwcm9wczogewogICAgdGFnOiB7CiAgICAgIHR5cGU6IFtTdHJpbmcsIEJvb2xlYW4sIE9iamVjdF0sCiAgICAgIGRlZmF1bHQ6ICdzcGFuJwogICAgfSwKICAgIHBhdGg6IHsKICAgICAgdHlwZTogU3RyaW5nLAogICAgICByZXF1aXJlZDogdHJ1ZQogICAgfSwKICAgIGxvY2FsZTogewogICAgICB0eXBlOiBTdHJpbmcKICAgIH0sCiAgICBwbGFjZXM6IHsKICAgICAgdHlwZTogW0FycmF5LCBPYmplY3RdCiAgICB9CiAgfSwKICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcihoLCByZWYpIHsKICAgIHZhciBkYXRhID0gcmVmLmRhdGE7CiAgICB2YXIgcGFyZW50ID0gcmVmLnBhcmVudDsKICAgIHZhciBwcm9wcyA9IHJlZi5wcm9wczsKICAgIHZhciBzbG90cyA9IHJlZi5zbG90czsKICAgIHZhciAkaTE4biA9IHBhcmVudC4kaTE4bjsKCiAgICBpZiAoISRpMThuKSB7CiAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAgICAgd2FybignQ2Fubm90IGZpbmQgVnVlSTE4biBpbnN0YW5jZSEnKTsKICAgICAgfQoKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciBwYXRoID0gcHJvcHMucGF0aDsKICAgIHZhciBsb2NhbGUgPSBwcm9wcy5sb2NhbGU7CiAgICB2YXIgcGxhY2VzID0gcHJvcHMucGxhY2VzOwogICAgdmFyIHBhcmFtcyA9IHNsb3RzKCk7CiAgICB2YXIgY2hpbGRyZW4gPSAkaTE4bi5pKHBhdGgsIGxvY2FsZSwgb25seUhhc0RlZmF1bHRQbGFjZShwYXJhbXMpIHx8IHBsYWNlcyA/IHVzZUxlZ2FjeVBsYWNlcyhwYXJhbXMuZGVmYXVsdCwgcGxhY2VzKSA6IHBhcmFtcyk7CiAgICB2YXIgdGFnID0gISFwcm9wcy50YWcgJiYgcHJvcHMudGFnICE9PSB0cnVlIHx8IHByb3BzLnRhZyA9PT0gZmFsc2UgPyBwcm9wcy50YWcgOiAnc3Bhbic7CiAgICByZXR1cm4gdGFnID8gaCh0YWcsIGRhdGEsIGNoaWxkcmVuKSA6IGNoaWxkcmVuOwogIH0KfTsKCmZ1bmN0aW9uIG9ubHlIYXNEZWZhdWx0UGxhY2UocGFyYW1zKSB7CiAgdmFyIHByb3A7CgogIGZvciAocHJvcCBpbiBwYXJhbXMpIHsKICAgIGlmIChwcm9wICE9PSAnZGVmYXVsdCcpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH0KCiAgcmV0dXJuIEJvb2xlYW4ocHJvcCk7Cn0KCmZ1bmN0aW9uIHVzZUxlZ2FjeVBsYWNlcyhjaGlsZHJlbiwgcGxhY2VzKSB7CiAgdmFyIHBhcmFtcyA9IHBsYWNlcyA/IGNyZWF0ZVBhcmFtc0Zyb21QbGFjZXMocGxhY2VzKSA6IHt9OwoKICBpZiAoIWNoaWxkcmVuKSB7CiAgICByZXR1cm4gcGFyYW1zOwogIH0gLy8gRmlsdGVyIGVtcHR5IHRleHQgbm9kZXMKCgogIGNoaWxkcmVuID0gY2hpbGRyZW4uZmlsdGVyKGZ1bmN0aW9uIChjaGlsZCkgewogICAgcmV0dXJuIGNoaWxkLnRhZyB8fCBjaGlsZC50ZXh0LnRyaW0oKSAhPT0gJyc7CiAgfSk7CiAgdmFyIGV2ZXJ5UGxhY2UgPSBjaGlsZHJlbi5ldmVyeSh2bm9kZUhhc1BsYWNlQXR0cmlidXRlKTsKCiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiYgZXZlcnlQbGFjZSkgewogICAgd2FybignYHBsYWNlYCBhdHRyaWJ1dGUgaXMgZGVwcmVjYXRlZCBpbiBuZXh0IG1ham9yIHZlcnNpb24uIFBsZWFzZSBzd2l0Y2ggdG8gVnVlIHNsb3RzLicpOwogIH0KCiAgcmV0dXJuIGNoaWxkcmVuLnJlZHVjZShldmVyeVBsYWNlID8gYXNzaWduQ2hpbGRQbGFjZSA6IGFzc2lnbkNoaWxkSW5kZXgsIHBhcmFtcyk7Cn0KCmZ1bmN0aW9uIGNyZWF0ZVBhcmFtc0Zyb21QbGFjZXMocGxhY2VzKSB7CiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHsKICAgIHdhcm4oJ2BwbGFjZXNgIHByb3AgaXMgZGVwcmVjYXRlZCBpbiBuZXh0IG1ham9yIHZlcnNpb24uIFBsZWFzZSBzd2l0Y2ggdG8gVnVlIHNsb3RzLicpOwogIH0KCiAgcmV0dXJuIEFycmF5LmlzQXJyYXkocGxhY2VzKSA/IHBsYWNlcy5yZWR1Y2UoYXNzaWduQ2hpbGRJbmRleCwge30pIDogT2JqZWN0LmFzc2lnbih7fSwgcGxhY2VzKTsKfQoKZnVuY3Rpb24gYXNzaWduQ2hpbGRQbGFjZShwYXJhbXMsIGNoaWxkKSB7CiAgaWYgKGNoaWxkLmRhdGEgJiYgY2hpbGQuZGF0YS5hdHRycyAmJiBjaGlsZC5kYXRhLmF0dHJzLnBsYWNlKSB7CiAgICBwYXJhbXNbY2hpbGQuZGF0YS5hdHRycy5wbGFjZV0gPSBjaGlsZDsKICB9CgogIHJldHVybiBwYXJhbXM7Cn0KCmZ1bmN0aW9uIGFzc2lnbkNoaWxkSW5kZXgocGFyYW1zLCBjaGlsZCwgaW5kZXgpIHsKICBwYXJhbXNbaW5kZXhdID0gY2hpbGQ7CiAgcmV0dXJuIHBhcmFtczsKfQoKZnVuY3Rpb24gdm5vZGVIYXNQbGFjZUF0dHJpYnV0ZSh2bm9kZSkgewogIHJldHVybiBCb29sZWFuKHZub2RlLmRhdGEgJiYgdm5vZGUuZGF0YS5hdHRycyAmJiB2bm9kZS5kYXRhLmF0dHJzLnBsYWNlKTsKfQovKiAgKi8KCgp2YXIgbnVtYmVyQ29tcG9uZW50ID0gewogIG5hbWU6ICdpMThuLW4nLAogIGZ1bmN0aW9uYWw6IHRydWUsCiAgcHJvcHM6IHsKICAgIHRhZzogewogICAgICB0eXBlOiBbU3RyaW5nLCBCb29sZWFuLCBPYmplY3RdLAogICAgICBkZWZhdWx0OiAnc3BhbicKICAgIH0sCiAgICB2YWx1ZTogewogICAgICB0eXBlOiBOdW1iZXIsCiAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICB9LAogICAgZm9ybWF0OiB7CiAgICAgIHR5cGU6IFtTdHJpbmcsIE9iamVjdF0KICAgIH0sCiAgICBsb2NhbGU6IHsKICAgICAgdHlwZTogU3RyaW5nCiAgICB9CiAgfSwKICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcihoLCByZWYpIHsKICAgIHZhciBwcm9wcyA9IHJlZi5wcm9wczsKICAgIHZhciBwYXJlbnQgPSByZWYucGFyZW50OwogICAgdmFyIGRhdGEgPSByZWYuZGF0YTsKICAgIHZhciBpMThuID0gcGFyZW50LiRpMThuOwoKICAgIGlmICghaTE4bikgewogICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgICAgIHdhcm4oJ0Nhbm5vdCBmaW5kIFZ1ZUkxOG4gaW5zdGFuY2UhJyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBudWxsOwogICAgfQoKICAgIHZhciBrZXkgPSBudWxsOwogICAgdmFyIG9wdGlvbnMgPSBudWxsOwoKICAgIGlmIChpc1N0cmluZyhwcm9wcy5mb3JtYXQpKSB7CiAgICAgIGtleSA9IHByb3BzLmZvcm1hdDsKICAgIH0gZWxzZSBpZiAoaXNPYmplY3QocHJvcHMuZm9ybWF0KSkgewogICAgICBpZiAocHJvcHMuZm9ybWF0LmtleSkgewogICAgICAgIGtleSA9IHByb3BzLmZvcm1hdC5rZXk7CiAgICAgIH0gLy8gRmlsdGVyIG91dCBudW1iZXIgZm9ybWF0IG9wdGlvbnMgb25seQoKCiAgICAgIG9wdGlvbnMgPSBPYmplY3Qua2V5cyhwcm9wcy5mb3JtYXQpLnJlZHVjZShmdW5jdGlvbiAoYWNjLCBwcm9wKSB7CiAgICAgICAgdmFyIG9iajsKCiAgICAgICAgaWYgKGluY2x1ZGVzKG51bWJlckZvcm1hdEtleXMsIHByb3ApKSB7CiAgICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih7fSwgYWNjLCAob2JqID0ge30sIG9ialtwcm9wXSA9IHByb3BzLmZvcm1hdFtwcm9wXSwgb2JqKSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gYWNjOwogICAgICB9LCBudWxsKTsKICAgIH0KCiAgICB2YXIgbG9jYWxlID0gcHJvcHMubG9jYWxlIHx8IGkxOG4ubG9jYWxlOwoKICAgIHZhciBwYXJ0cyA9IGkxOG4uX250cChwcm9wcy52YWx1ZSwgbG9jYWxlLCBrZXksIG9wdGlvbnMpOwoKICAgIHZhciB2YWx1ZXMgPSBwYXJ0cy5tYXAoZnVuY3Rpb24gKHBhcnQsIGluZGV4KSB7CiAgICAgIHZhciBvYmo7CiAgICAgIHZhciBzbG90ID0gZGF0YS5zY29wZWRTbG90cyAmJiBkYXRhLnNjb3BlZFNsb3RzW3BhcnQudHlwZV07CiAgICAgIHJldHVybiBzbG90ID8gc2xvdCgob2JqID0ge30sIG9ialtwYXJ0LnR5cGVdID0gcGFydC52YWx1ZSwgb2JqLmluZGV4ID0gaW5kZXgsIG9iai5wYXJ0cyA9IHBhcnRzLCBvYmopKSA6IHBhcnQudmFsdWU7CiAgICB9KTsKICAgIHZhciB0YWcgPSAhIXByb3BzLnRhZyAmJiBwcm9wcy50YWcgIT09IHRydWUgfHwgcHJvcHMudGFnID09PSBmYWxzZSA/IHByb3BzLnRhZyA6ICdzcGFuJzsKICAgIHJldHVybiB0YWcgPyBoKHRhZywgewogICAgICBhdHRyczogZGF0YS5hdHRycywKICAgICAgJ2NsYXNzJzogZGF0YVsnY2xhc3MnXSwKICAgICAgc3RhdGljQ2xhc3M6IGRhdGEuc3RhdGljQ2xhc3MKICAgIH0sIHZhbHVlcykgOiB2YWx1ZXM7CiAgfQp9OwovKiAgKi8KCmZ1bmN0aW9uIGJpbmQoZWwsIGJpbmRpbmcsIHZub2RlKSB7CiAgaWYgKCFhc3NlcnQoZWwsIHZub2RlKSkgewogICAgcmV0dXJuOwogIH0KCiAgdChlbCwgYmluZGluZywgdm5vZGUpOwp9CgpmdW5jdGlvbiB1cGRhdGUoZWwsIGJpbmRpbmcsIHZub2RlLCBvbGRWTm9kZSkgewogIGlmICghYXNzZXJ0KGVsLCB2bm9kZSkpIHsKICAgIHJldHVybjsKICB9CgogIHZhciBpMThuID0gdm5vZGUuY29udGV4dC4kaTE4bjsKCiAgaWYgKGxvY2FsZUVxdWFsKGVsLCB2bm9kZSkgJiYgbG9vc2VFcXVhbChiaW5kaW5nLnZhbHVlLCBiaW5kaW5nLm9sZFZhbHVlKSAmJiBsb29zZUVxdWFsKGVsLl9sb2NhbGVNZXNzYWdlLCBpMThuLmdldExvY2FsZU1lc3NhZ2UoaTE4bi5sb2NhbGUpKSkgewogICAgcmV0dXJuOwogIH0KCiAgdChlbCwgYmluZGluZywgdm5vZGUpOwp9CgpmdW5jdGlvbiB1bmJpbmQoZWwsIGJpbmRpbmcsIHZub2RlLCBvbGRWTm9kZSkgewogIHZhciB2bSA9IHZub2RlLmNvbnRleHQ7CgogIGlmICghdm0pIHsKICAgIHdhcm4oJ1Z1ZSBpbnN0YW5jZSBkb2VzIG5vdCBleGlzdHMgaW4gVk5vZGUgY29udGV4dCcpOwogICAgcmV0dXJuOwogIH0KCiAgdmFyIGkxOG4gPSB2bm9kZS5jb250ZXh0LiRpMThuIHx8IHt9OwoKICBpZiAoIWJpbmRpbmcubW9kaWZpZXJzLnByZXNlcnZlICYmICFpMThuLnByZXNlcnZlRGlyZWN0aXZlQ29udGVudCkgewogICAgZWwudGV4dENvbnRlbnQgPSAnJzsKICB9CgogIGVsLl92dCA9IHVuZGVmaW5lZDsKICBkZWxldGUgZWxbJ192dCddOwogIGVsLl9sb2NhbGUgPSB1bmRlZmluZWQ7CiAgZGVsZXRlIGVsWydfbG9jYWxlJ107CiAgZWwuX2xvY2FsZU1lc3NhZ2UgPSB1bmRlZmluZWQ7CiAgZGVsZXRlIGVsWydfbG9jYWxlTWVzc2FnZSddOwp9CgpmdW5jdGlvbiBhc3NlcnQoZWwsIHZub2RlKSB7CiAgdmFyIHZtID0gdm5vZGUuY29udGV4dDsKCiAgaWYgKCF2bSkgewogICAgd2FybignVnVlIGluc3RhbmNlIGRvZXMgbm90IGV4aXN0cyBpbiBWTm9kZSBjb250ZXh0Jyk7CiAgICByZXR1cm4gZmFsc2U7CiAgfQoKICBpZiAoIXZtLiRpMThuKSB7CiAgICB3YXJuKCdWdWVJMThuIGluc3RhbmNlIGRvZXMgbm90IGV4aXN0cyBpbiBWdWUgaW5zdGFuY2UnKTsKICAgIHJldHVybiBmYWxzZTsKICB9CgogIHJldHVybiB0cnVlOwp9CgpmdW5jdGlvbiBsb2NhbGVFcXVhbChlbCwgdm5vZGUpIHsKICB2YXIgdm0gPSB2bm9kZS5jb250ZXh0OwogIHJldHVybiBlbC5fbG9jYWxlID09PSB2bS4kaTE4bi5sb2NhbGU7Cn0KCmZ1bmN0aW9uIHQoZWwsIGJpbmRpbmcsIHZub2RlKSB7CiAgdmFyIHJlZiQxLCByZWYkMjsKICB2YXIgdmFsdWUgPSBiaW5kaW5nLnZhbHVlOwogIHZhciByZWYgPSBwYXJzZVZhbHVlKHZhbHVlKTsKICB2YXIgcGF0aCA9IHJlZi5wYXRoOwogIHZhciBsb2NhbGUgPSByZWYubG9jYWxlOwogIHZhciBhcmdzID0gcmVmLmFyZ3M7CiAgdmFyIGNob2ljZSA9IHJlZi5jaG9pY2U7CgogIGlmICghcGF0aCAmJiAhbG9jYWxlICYmICFhcmdzKSB7CiAgICB3YXJuKCd2YWx1ZSB0eXBlIG5vdCBzdXBwb3J0ZWQnKTsKICAgIHJldHVybjsKICB9CgogIGlmICghcGF0aCkgewogICAgd2FybignYHBhdGhgIGlzIHJlcXVpcmVkIGluIHYtdCBkaXJlY3RpdmUnKTsKICAgIHJldHVybjsKICB9CgogIHZhciB2bSA9IHZub2RlLmNvbnRleHQ7CgogIGlmIChjaG9pY2UgIT0gbnVsbCkgewogICAgZWwuX3Z0ID0gZWwudGV4dENvbnRlbnQgPSAocmVmJDEgPSB2bS4kaTE4bikudGMuYXBwbHkocmVmJDEsIFtwYXRoLCBjaG9pY2VdLmNvbmNhdChtYWtlUGFyYW1zKGxvY2FsZSwgYXJncykpKTsKICB9IGVsc2UgewogICAgZWwuX3Z0ID0gZWwudGV4dENvbnRlbnQgPSAocmVmJDIgPSB2bS4kaTE4bikudC5hcHBseShyZWYkMiwgW3BhdGhdLmNvbmNhdChtYWtlUGFyYW1zKGxvY2FsZSwgYXJncykpKTsKICB9CgogIGVsLl9sb2NhbGUgPSB2bS4kaTE4bi5sb2NhbGU7CiAgZWwuX2xvY2FsZU1lc3NhZ2UgPSB2bS4kaTE4bi5nZXRMb2NhbGVNZXNzYWdlKHZtLiRpMThuLmxvY2FsZSk7Cn0KCmZ1bmN0aW9uIHBhcnNlVmFsdWUodmFsdWUpIHsKICB2YXIgcGF0aDsKICB2YXIgbG9jYWxlOwogIHZhciBhcmdzOwogIHZhciBjaG9pY2U7CgogIGlmIChpc1N0cmluZyh2YWx1ZSkpIHsKICAgIHBhdGggPSB2YWx1ZTsKICB9IGVsc2UgaWYgKGlzUGxhaW5PYmplY3QodmFsdWUpKSB7CiAgICBwYXRoID0gdmFsdWUucGF0aDsKICAgIGxvY2FsZSA9IHZhbHVlLmxvY2FsZTsKICAgIGFyZ3MgPSB2YWx1ZS5hcmdzOwogICAgY2hvaWNlID0gdmFsdWUuY2hvaWNlOwogIH0KCiAgcmV0dXJuIHsKICAgIHBhdGg6IHBhdGgsCiAgICBsb2NhbGU6IGxvY2FsZSwKICAgIGFyZ3M6IGFyZ3MsCiAgICBjaG9pY2U6IGNob2ljZQogIH07Cn0KCmZ1bmN0aW9uIG1ha2VQYXJhbXMobG9jYWxlLCBhcmdzKSB7CiAgdmFyIHBhcmFtcyA9IFtdOwogIGxvY2FsZSAmJiBwYXJhbXMucHVzaChsb2NhbGUpOwoKICBpZiAoYXJncyAmJiAoQXJyYXkuaXNBcnJheShhcmdzKSB8fCBpc1BsYWluT2JqZWN0KGFyZ3MpKSkgewogICAgcGFyYW1zLnB1c2goYXJncyk7CiAgfQoKICByZXR1cm4gcGFyYW1zOwp9Cgp2YXIgVnVlOwoKZnVuY3Rpb24gaW5zdGFsbChfVnVlLCBvcHRpb25zKSB7CiAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgb3B0aW9ucyA9IHsKICAgIGJyaWRnZTogZmFsc2UKICB9OwogIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwoKICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyAmJiBpbnN0YWxsLmluc3RhbGxlZCAmJiBfVnVlID09PSBWdWUpIHsKICAgIHdhcm4oJ2FscmVhZHkgaW5zdGFsbGVkLicpOwogICAgcmV0dXJuOwogIH0KCiAgaW5zdGFsbC5pbnN0YWxsZWQgPSB0cnVlOwogIFZ1ZSA9IF9WdWU7CiAgdmFyIHZlcnNpb24gPSBWdWUudmVyc2lvbiAmJiBOdW1iZXIoVnVlLnZlcnNpb24uc3BsaXQoJy4nKVswXSkgfHwgLTE7CiAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCgogIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nICYmIHZlcnNpb24gPCAyKSB7CiAgICB3YXJuKCJ2dWUtaTE4biAoIiArIGluc3RhbGwudmVyc2lvbiArICIpIG5lZWQgdG8gdXNlIFZ1ZSAyLjAgb3IgbGF0ZXIgKFZ1ZTogIiArIFZ1ZS52ZXJzaW9uICsgIikuIik7CiAgICByZXR1cm47CiAgfQoKICBleHRlbmQoVnVlKTsKICBWdWUubWl4aW4oZGVmaW5lTWl4aW4ob3B0aW9ucy5icmlkZ2UpKTsKICBWdWUuZGlyZWN0aXZlKCd0JywgewogICAgYmluZDogYmluZCwKICAgIHVwZGF0ZTogdXBkYXRlLAogICAgdW5iaW5kOiB1bmJpbmQKICB9KTsKICBWdWUuY29tcG9uZW50KGludGVycG9sYXRpb25Db21wb25lbnQubmFtZSwgaW50ZXJwb2xhdGlvbkNvbXBvbmVudCk7CiAgVnVlLmNvbXBvbmVudChudW1iZXJDb21wb25lbnQubmFtZSwgbnVtYmVyQ29tcG9uZW50KTsgLy8gdXNlIHNpbXBsZSBtZXJnZVN0cmF0ZWdpZXMgdG8gcHJldmVudCBpMThuIGluc3RhbmNlIGxvc2UgJ19fcHJvdG9fXycKCiAgdmFyIHN0cmF0cyA9IFZ1ZS5jb25maWcub3B0aW9uTWVyZ2VTdHJhdGVnaWVzOwoKICBzdHJhdHMuaTE4biA9IGZ1bmN0aW9uIChwYXJlbnRWYWwsIGNoaWxkVmFsKSB7CiAgICByZXR1cm4gY2hpbGRWYWwgPT09IHVuZGVmaW5lZCA/IHBhcmVudFZhbCA6IGNoaWxkVmFsOwogIH07Cn0KLyogICovCgoKdmFyIEJhc2VGb3JtYXR0ZXIgPSBmdW5jdGlvbiBCYXNlRm9ybWF0dGVyKCkgewogIHRoaXMuX2NhY2hlcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7Cn07CgpCYXNlRm9ybWF0dGVyLnByb3RvdHlwZS5pbnRlcnBvbGF0ZSA9IGZ1bmN0aW9uIGludGVycG9sYXRlKG1lc3NhZ2UsIHZhbHVlcykgewogIGlmICghdmFsdWVzKSB7CiAgICByZXR1cm4gW21lc3NhZ2VdOwogIH0KCiAgdmFyIHRva2VucyA9IHRoaXMuX2NhY2hlc1ttZXNzYWdlXTsKCiAgaWYgKCF0b2tlbnMpIHsKICAgIHRva2VucyA9IHBhcnNlKG1lc3NhZ2UpOwogICAgdGhpcy5fY2FjaGVzW21lc3NhZ2VdID0gdG9rZW5zOwogIH0KCiAgcmV0dXJuIGNvbXBpbGUodG9rZW5zLCB2YWx1ZXMpOwp9OwoKdmFyIFJFX1RPS0VOX0xJU1RfVkFMVUUgPSAvXig/OlxkKSsvOwp2YXIgUkVfVE9LRU5fTkFNRURfVkFMVUUgPSAvXig/Olx3KSsvOwoKZnVuY3Rpb24gcGFyc2UoZm9ybWF0KSB7CiAgdmFyIHRva2VucyA9IFtdOwogIHZhciBwb3NpdGlvbiA9IDA7CiAgdmFyIHRleHQgPSAnJzsKCiAgd2hpbGUgKHBvc2l0aW9uIDwgZm9ybWF0Lmxlbmd0aCkgewogICAgdmFyIGNoYXIgPSBmb3JtYXRbcG9zaXRpb24rK107CgogICAgaWYgKGNoYXIgPT09ICd7JykgewogICAgICBpZiAodGV4dCkgewogICAgICAgIHRva2Vucy5wdXNoKHsKICAgICAgICAgIHR5cGU6ICd0ZXh0JywKICAgICAgICAgIHZhbHVlOiB0ZXh0CiAgICAgICAgfSk7CiAgICAgIH0KCiAgICAgIHRleHQgPSAnJzsKICAgICAgdmFyIHN1YiA9ICcnOwogICAgICBjaGFyID0gZm9ybWF0W3Bvc2l0aW9uKytdOwoKICAgICAgd2hpbGUgKGNoYXIgIT09IHVuZGVmaW5lZCAmJiBjaGFyICE9PSAnfScpIHsKICAgICAgICBzdWIgKz0gY2hhcjsKICAgICAgICBjaGFyID0gZm9ybWF0W3Bvc2l0aW9uKytdOwogICAgICB9CgogICAgICB2YXIgaXNDbG9zZWQgPSBjaGFyID09PSAnfSc7CiAgICAgIHZhciB0eXBlID0gUkVfVE9LRU5fTElTVF9WQUxVRS50ZXN0KHN1YikgPyAnbGlzdCcgOiBpc0Nsb3NlZCAmJiBSRV9UT0tFTl9OQU1FRF9WQUxVRS50ZXN0KHN1YikgPyAnbmFtZWQnIDogJ3Vua25vd24nOwogICAgICB0b2tlbnMucHVzaCh7CiAgICAgICAgdmFsdWU6IHN1YiwKICAgICAgICB0eXBlOiB0eXBlCiAgICAgIH0pOwogICAgfSBlbHNlIGlmIChjaGFyID09PSAnJScpIHsKICAgICAgLy8gd2hlbiBmb3VuZCByYWlscyBpMThuIHN5bnRheCwgc2tpcCB0ZXh0IGNhcHR1cmUKICAgICAgaWYgKGZvcm1hdFtwb3NpdGlvbl0gIT09ICd7JykgewogICAgICAgIHRleHQgKz0gY2hhcjsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdGV4dCArPSBjaGFyOwogICAgfQogIH0KCiAgdGV4dCAmJiB0b2tlbnMucHVzaCh7CiAgICB0eXBlOiAndGV4dCcsCiAgICB2YWx1ZTogdGV4dAogIH0pOwogIHJldHVybiB0b2tlbnM7Cn0KCmZ1bmN0aW9uIGNvbXBpbGUodG9rZW5zLCB2YWx1ZXMpIHsKICB2YXIgY29tcGlsZWQgPSBbXTsKICB2YXIgaW5kZXggPSAwOwogIHZhciBtb2RlID0gQXJyYXkuaXNBcnJheSh2YWx1ZXMpID8gJ2xpc3QnIDogaXNPYmplY3QodmFsdWVzKSA/ICduYW1lZCcgOiAndW5rbm93bic7CgogIGlmIChtb2RlID09PSAndW5rbm93bicpIHsKICAgIHJldHVybiBjb21waWxlZDsKICB9CgogIHdoaWxlIChpbmRleCA8IHRva2Vucy5sZW5ndGgpIHsKICAgIHZhciB0b2tlbiA9IHRva2Vuc1tpbmRleF07CgogICAgc3dpdGNoICh0b2tlbi50eXBlKSB7CiAgICAgIGNhc2UgJ3RleHQnOgogICAgICAgIGNvbXBpbGVkLnB1c2godG9rZW4udmFsdWUpOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnbGlzdCc6CiAgICAgICAgY29tcGlsZWQucHVzaCh2YWx1ZXNbcGFyc2VJbnQodG9rZW4udmFsdWUsIDEwKV0pOwogICAgICAgIGJyZWFrOwoKICAgICAgY2FzZSAnbmFtZWQnOgogICAgICAgIGlmIChtb2RlID09PSAnbmFtZWQnKSB7CiAgICAgICAgICBjb21waWxlZC5wdXNoKHZhbHVlc1t0b2tlbi52YWx1ZV0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgICAgICAgICB3YXJuKCJUeXBlIG9mIHRva2VuICciICsgdG9rZW4udHlwZSArICInIGFuZCBmb3JtYXQgb2YgdmFsdWUgJyIgKyBtb2RlICsgIicgZG9uJ3QgbWF0Y2ghIik7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ3Vua25vd24nOgogICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAgICAgICB3YXJuKCJEZXRlY3QgJ3Vua25vd24nIHR5cGUgb2YgdG9rZW4hIik7CiAgICAgICAgfQoKICAgICAgICBicmVhazsKICAgIH0KCiAgICBpbmRleCsrOwogIH0KCiAgcmV0dXJuIGNvbXBpbGVkOwp9Ci8qICAqLwoKLyoqCiAqICBQYXRoIHBhcnNlcgogKiAgLSBJbnNwaXJlZDoKICogICAgVnVlLmpzIFBhdGggcGFyc2VyCiAqLwovLyBhY3Rpb25zCgoKdmFyIEFQUEVORCA9IDA7CnZhciBQVVNIID0gMTsKdmFyIElOQ19TVUJfUEFUSF9ERVBUSCA9IDI7CnZhciBQVVNIX1NVQl9QQVRIID0gMzsgLy8gc3RhdGVzCgp2YXIgQkVGT1JFX1BBVEggPSAwOwp2YXIgSU5fUEFUSCA9IDE7CnZhciBCRUZPUkVfSURFTlQgPSAyOwp2YXIgSU5fSURFTlQgPSAzOwp2YXIgSU5fU1VCX1BBVEggPSA0Owp2YXIgSU5fU0lOR0xFX1FVT1RFID0gNTsKdmFyIElOX0RPVUJMRV9RVU9URSA9IDY7CnZhciBBRlRFUl9QQVRIID0gNzsKdmFyIEVSUk9SID0gODsKdmFyIHBhdGhTdGF0ZU1hY2hpbmUgPSBbXTsKcGF0aFN0YXRlTWFjaGluZVtCRUZPUkVfUEFUSF0gPSB7CiAgJ3dzJzogW0JFRk9SRV9QQVRIXSwKICAnaWRlbnQnOiBbSU5fSURFTlQsIEFQUEVORF0sCiAgJ1snOiBbSU5fU1VCX1BBVEhdLAogICdlb2YnOiBbQUZURVJfUEFUSF0KfTsKcGF0aFN0YXRlTWFjaGluZVtJTl9QQVRIXSA9IHsKICAnd3MnOiBbSU5fUEFUSF0sCiAgJy4nOiBbQkVGT1JFX0lERU5UXSwKICAnWyc6IFtJTl9TVUJfUEFUSF0sCiAgJ2VvZic6IFtBRlRFUl9QQVRIXQp9OwpwYXRoU3RhdGVNYWNoaW5lW0JFRk9SRV9JREVOVF0gPSB7CiAgJ3dzJzogW0JFRk9SRV9JREVOVF0sCiAgJ2lkZW50JzogW0lOX0lERU5ULCBBUFBFTkRdLAogICcwJzogW0lOX0lERU5ULCBBUFBFTkRdLAogICdudW1iZXInOiBbSU5fSURFTlQsIEFQUEVORF0KfTsKcGF0aFN0YXRlTWFjaGluZVtJTl9JREVOVF0gPSB7CiAgJ2lkZW50JzogW0lOX0lERU5ULCBBUFBFTkRdLAogICcwJzogW0lOX0lERU5ULCBBUFBFTkRdLAogICdudW1iZXInOiBbSU5fSURFTlQsIEFQUEVORF0sCiAgJ3dzJzogW0lOX1BBVEgsIFBVU0hdLAogICcuJzogW0JFRk9SRV9JREVOVCwgUFVTSF0sCiAgJ1snOiBbSU5fU1VCX1BBVEgsIFBVU0hdLAogICdlb2YnOiBbQUZURVJfUEFUSCwgUFVTSF0KfTsKcGF0aFN0YXRlTWFjaGluZVtJTl9TVUJfUEFUSF0gPSB7CiAgIiciOiBbSU5fU0lOR0xFX1FVT1RFLCBBUFBFTkRdLAogICciJzogW0lOX0RPVUJMRV9RVU9URSwgQVBQRU5EXSwKICAnWyc6IFtJTl9TVUJfUEFUSCwgSU5DX1NVQl9QQVRIX0RFUFRIXSwKICAnXSc6IFtJTl9QQVRILCBQVVNIX1NVQl9QQVRIXSwKICAnZW9mJzogRVJST1IsCiAgJ2Vsc2UnOiBbSU5fU1VCX1BBVEgsIEFQUEVORF0KfTsKcGF0aFN0YXRlTWFjaGluZVtJTl9TSU5HTEVfUVVPVEVdID0gewogICInIjogW0lOX1NVQl9QQVRILCBBUFBFTkRdLAogICdlb2YnOiBFUlJPUiwKICAnZWxzZSc6IFtJTl9TSU5HTEVfUVVPVEUsIEFQUEVORF0KfTsKcGF0aFN0YXRlTWFjaGluZVtJTl9ET1VCTEVfUVVPVEVdID0gewogICciJzogW0lOX1NVQl9QQVRILCBBUFBFTkRdLAogICdlb2YnOiBFUlJPUiwKICAnZWxzZSc6IFtJTl9ET1VCTEVfUVVPVEUsIEFQUEVORF0KfTsKLyoqCiAqIENoZWNrIGlmIGFuIGV4cHJlc3Npb24gaXMgYSBsaXRlcmFsIHZhbHVlLgogKi8KCnZhciBsaXRlcmFsVmFsdWVSRSA9IC9eXHM/KD86dHJ1ZXxmYWxzZXwtP1tcZC5dK3wnW14nXSonfCJbXiJdKiIpXHM/JC87CgpmdW5jdGlvbiBpc0xpdGVyYWwoZXhwKSB7CiAgcmV0dXJuIGxpdGVyYWxWYWx1ZVJFLnRlc3QoZXhwKTsKfQovKioKICogU3RyaXAgcXVvdGVzIGZyb20gYSBzdHJpbmcKICovCgoKZnVuY3Rpb24gc3RyaXBRdW90ZXMoc3RyKSB7CiAgdmFyIGEgPSBzdHIuY2hhckNvZGVBdCgwKTsKICB2YXIgYiA9IHN0ci5jaGFyQ29kZUF0KHN0ci5sZW5ndGggLSAxKTsKICByZXR1cm4gYSA9PT0gYiAmJiAoYSA9PT0gMHgyMiB8fCBhID09PSAweDI3KSA/IHN0ci5zbGljZSgxLCAtMSkgOiBzdHI7Cn0KLyoqCiAqIERldGVybWluZSB0aGUgdHlwZSBvZiBhIGNoYXJhY3RlciBpbiBhIGtleXBhdGguCiAqLwoKCmZ1bmN0aW9uIGdldFBhdGhDaGFyVHlwZShjaCkgewogIGlmIChjaCA9PT0gdW5kZWZpbmVkIHx8IGNoID09PSBudWxsKSB7CiAgICByZXR1cm4gJ2VvZic7CiAgfQoKICB2YXIgY29kZSA9IGNoLmNoYXJDb2RlQXQoMCk7CgogIHN3aXRjaCAoY29kZSkgewogICAgY2FzZSAweDVCOiAvLyBbCgogICAgY2FzZSAweDVEOiAvLyBdCgogICAgY2FzZSAweDJFOiAvLyAuCgogICAgY2FzZSAweDIyOiAvLyAiCgogICAgY2FzZSAweDI3OgogICAgICAvLyAnCiAgICAgIHJldHVybiBjaDsKCiAgICBjYXNlIDB4NUY6IC8vIF8KCiAgICBjYXNlIDB4MjQ6IC8vICQKCiAgICBjYXNlIDB4MkQ6CiAgICAgIC8vIC0KICAgICAgcmV0dXJuICdpZGVudCc7CgogICAgY2FzZSAweDA5OiAvLyBUYWIKCiAgICBjYXNlIDB4MEE6IC8vIE5ld2xpbmUKCiAgICBjYXNlIDB4MEQ6IC8vIFJldHVybgoKICAgIGNhc2UgMHhBMDogLy8gTm8tYnJlYWsgc3BhY2UKCiAgICBjYXNlIDB4RkVGRjogLy8gQnl0ZSBPcmRlciBNYXJrCgogICAgY2FzZSAweDIwMjg6IC8vIExpbmUgU2VwYXJhdG9yCgogICAgY2FzZSAweDIwMjk6CiAgICAgIC8vIFBhcmFncmFwaCBTZXBhcmF0b3IKICAgICAgcmV0dXJuICd3cyc7CiAgfQoKICByZXR1cm4gJ2lkZW50JzsKfQovKioKICogRm9ybWF0IGEgc3ViUGF0aCwgcmV0dXJuIGl0cyBwbGFpbiBmb3JtIGlmIGl0IGlzCiAqIGEgbGl0ZXJhbCBzdHJpbmcgb3IgbnVtYmVyLiBPdGhlcndpc2UgcHJlcGVuZCB0aGUKICogZHluYW1pYyBpbmRpY2F0b3IgKCopLgogKi8KCgpmdW5jdGlvbiBmb3JtYXRTdWJQYXRoKHBhdGgpIHsKICB2YXIgdHJpbW1lZCA9IHBhdGgudHJpbSgpOyAvLyBpbnZhbGlkIGxlYWRpbmcgMAoKICBpZiAocGF0aC5jaGFyQXQoMCkgPT09ICcwJyAmJiBpc05hTihwYXRoKSkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgcmV0dXJuIGlzTGl0ZXJhbCh0cmltbWVkKSA/IHN0cmlwUXVvdGVzKHRyaW1tZWQpIDogJyonICsgdHJpbW1lZDsKfQovKioKICogUGFyc2UgYSBzdHJpbmcgcGF0aCBpbnRvIGFuIGFycmF5IG9mIHNlZ21lbnRzCiAqLwoKCmZ1bmN0aW9uIHBhcnNlJDEocGF0aCkgewogIHZhciBrZXlzID0gW107CiAgdmFyIGluZGV4ID0gLTE7CiAgdmFyIG1vZGUgPSBCRUZPUkVfUEFUSDsKICB2YXIgc3ViUGF0aERlcHRoID0gMDsKICB2YXIgYzsKICB2YXIga2V5OwogIHZhciBuZXdDaGFyOwogIHZhciB0eXBlOwogIHZhciB0cmFuc2l0aW9uOwogIHZhciBhY3Rpb247CiAgdmFyIHR5cGVNYXA7CiAgdmFyIGFjdGlvbnMgPSBbXTsKCiAgYWN0aW9uc1tQVVNIXSA9IGZ1bmN0aW9uICgpIHsKICAgIGlmIChrZXkgIT09IHVuZGVmaW5lZCkgewogICAgICBrZXlzLnB1c2goa2V5KTsKICAgICAga2V5ID0gdW5kZWZpbmVkOwogICAgfQogIH07CgogIGFjdGlvbnNbQVBQRU5EXSA9IGZ1bmN0aW9uICgpIHsKICAgIGlmIChrZXkgPT09IHVuZGVmaW5lZCkgewogICAgICBrZXkgPSBuZXdDaGFyOwogICAgfSBlbHNlIHsKICAgICAga2V5ICs9IG5ld0NoYXI7CiAgICB9CiAgfTsKCiAgYWN0aW9uc1tJTkNfU1VCX1BBVEhfREVQVEhdID0gZnVuY3Rpb24gKCkgewogICAgYWN0aW9uc1tBUFBFTkRdKCk7CiAgICBzdWJQYXRoRGVwdGgrKzsKICB9OwoKICBhY3Rpb25zW1BVU0hfU1VCX1BBVEhdID0gZnVuY3Rpb24gKCkgewogICAgaWYgKHN1YlBhdGhEZXB0aCA+IDApIHsKICAgICAgc3ViUGF0aERlcHRoLS07CiAgICAgIG1vZGUgPSBJTl9TVUJfUEFUSDsKICAgICAgYWN0aW9uc1tBUFBFTkRdKCk7CiAgICB9IGVsc2UgewogICAgICBzdWJQYXRoRGVwdGggPSAwOwoKICAgICAgaWYgKGtleSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICBrZXkgPSBmb3JtYXRTdWJQYXRoKGtleSk7CgogICAgICBpZiAoa2V5ID09PSBmYWxzZSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBhY3Rpb25zW1BVU0hdKCk7CiAgICAgIH0KICAgIH0KICB9OwoKICBmdW5jdGlvbiBtYXliZVVuZXNjYXBlUXVvdGUoKSB7CiAgICB2YXIgbmV4dENoYXIgPSBwYXRoW2luZGV4ICsgMV07CgogICAgaWYgKG1vZGUgPT09IElOX1NJTkdMRV9RVU9URSAmJiBuZXh0Q2hhciA9PT0gIiciIHx8IG1vZGUgPT09IElOX0RPVUJMRV9RVU9URSAmJiBuZXh0Q2hhciA9PT0gJyInKSB7CiAgICAgIGluZGV4Kys7CiAgICAgIG5ld0NoYXIgPSAnXFwnICsgbmV4dENoYXI7CiAgICAgIGFjdGlvbnNbQVBQRU5EXSgpOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICB9CgogIHdoaWxlIChtb2RlICE9PSBudWxsKSB7CiAgICBpbmRleCsrOwogICAgYyA9IHBhdGhbaW5kZXhdOwoKICAgIGlmIChjID09PSAnXFwnICYmIG1heWJlVW5lc2NhcGVRdW90ZSgpKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQoKICAgIHR5cGUgPSBnZXRQYXRoQ2hhclR5cGUoYyk7CiAgICB0eXBlTWFwID0gcGF0aFN0YXRlTWFjaGluZVttb2RlXTsKICAgIHRyYW5zaXRpb24gPSB0eXBlTWFwW3R5cGVdIHx8IHR5cGVNYXBbJ2Vsc2UnXSB8fCBFUlJPUjsKCiAgICBpZiAodHJhbnNpdGlvbiA9PT0gRVJST1IpIHsKICAgICAgcmV0dXJuOyAvLyBwYXJzZSBlcnJvcgogICAgfQoKICAgIG1vZGUgPSB0cmFuc2l0aW9uWzBdOwogICAgYWN0aW9uID0gYWN0aW9uc1t0cmFuc2l0aW9uWzFdXTsKCiAgICBpZiAoYWN0aW9uKSB7CiAgICAgIG5ld0NoYXIgPSB0cmFuc2l0aW9uWzJdOwogICAgICBuZXdDaGFyID0gbmV3Q2hhciA9PT0gdW5kZWZpbmVkID8gYyA6IG5ld0NoYXI7CgogICAgICBpZiAoYWN0aW9uKCkgPT09IGZhbHNlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICB9CgogICAgaWYgKG1vZGUgPT09IEFGVEVSX1BBVEgpIHsKICAgICAgcmV0dXJuIGtleXM7CiAgICB9CiAgfQp9Cgp2YXIgSTE4blBhdGggPSBmdW5jdGlvbiBJMThuUGF0aCgpIHsKICB0aGlzLl9jYWNoZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7Cn07Ci8qKgogKiBFeHRlcm5hbCBwYXJzZSB0aGF0IGNoZWNrIGZvciBhIGNhY2hlIGhpdCBmaXJzdAogKi8KCgpJMThuUGF0aC5wcm90b3R5cGUucGFyc2VQYXRoID0gZnVuY3Rpb24gcGFyc2VQYXRoKHBhdGgpIHsKICB2YXIgaGl0ID0gdGhpcy5fY2FjaGVbcGF0aF07CgogIGlmICghaGl0KSB7CiAgICBoaXQgPSBwYXJzZSQxKHBhdGgpOwoKICAgIGlmIChoaXQpIHsKICAgICAgdGhpcy5fY2FjaGVbcGF0aF0gPSBoaXQ7CiAgICB9CiAgfQoKICByZXR1cm4gaGl0IHx8IFtdOwp9OwovKioKICogR2V0IHBhdGggdmFsdWUgZnJvbSBwYXRoIHN0cmluZwogKi8KCgpJMThuUGF0aC5wcm90b3R5cGUuZ2V0UGF0aFZhbHVlID0gZnVuY3Rpb24gZ2V0UGF0aFZhbHVlKG9iaiwgcGF0aCkgewogIGlmICghaXNPYmplY3Qob2JqKSkgewogICAgcmV0dXJuIG51bGw7CiAgfQoKICB2YXIgcGF0aHMgPSB0aGlzLnBhcnNlUGF0aChwYXRoKTsKCiAgaWYgKHBhdGhzLmxlbmd0aCA9PT0gMCkgewogICAgcmV0dXJuIG51bGw7CiAgfSBlbHNlIHsKICAgIHZhciBsZW5ndGggPSBwYXRocy5sZW5ndGg7CiAgICB2YXIgbGFzdCA9IG9iajsKICAgIHZhciBpID0gMDsKCiAgICB3aGlsZSAoaSA8IGxlbmd0aCkgewogICAgICB2YXIgdmFsdWUgPSBsYXN0W3BhdGhzW2ldXTsKCiAgICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlID09PSBudWxsKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KCiAgICAgIGxhc3QgPSB2YWx1ZTsKICAgICAgaSsrOwogICAgfQoKICAgIHJldHVybiBsYXN0OwogIH0KfTsKLyogICovCgoKdmFyIGh0bWxUYWdNYXRjaGVyID0gLzxcLz9bXHdccz0iLy4nOjsjLVwvXSs+LzsKdmFyIGxpbmtLZXlNYXRjaGVyID0gLyg/OkAoPzpcLlthLXpBLVpdKyk/Oig/Oltcd1wtX3wuL10rfFwoW1x3XC1fOnwuL10rXCkpKS9nOwp2YXIgbGlua0tleVByZWZpeE1hdGNoZXIgPSAvXkAoPzpcLihbYS16QS1aXSspKT86LzsKdmFyIGJyYWNrZXRzTWF0Y2hlciA9IC9bKCldL2c7CnZhciBkZWZhdWx0TW9kaWZpZXJzID0gewogICd1cHBlcic6IGZ1bmN0aW9uIChzdHIpIHsKICAgIHJldHVybiBzdHIudG9Mb2NhbGVVcHBlckNhc2UoKTsKICB9LAogICdsb3dlcic6IGZ1bmN0aW9uIChzdHIpIHsKICAgIHJldHVybiBzdHIudG9Mb2NhbGVMb3dlckNhc2UoKTsKICB9LAogICdjYXBpdGFsaXplJzogZnVuY3Rpb24gKHN0cikgewogICAgcmV0dXJuICIiICsgc3RyLmNoYXJBdCgwKS50b0xvY2FsZVVwcGVyQ2FzZSgpICsgc3RyLnN1YnN0cigxKTsKICB9Cn07CnZhciBkZWZhdWx0Rm9ybWF0dGVyID0gbmV3IEJhc2VGb3JtYXR0ZXIoKTsKCnZhciBWdWVJMThuID0gZnVuY3Rpb24gVnVlSTE4bihvcHRpb25zKSB7CiAgdmFyIHRoaXMkMSA9IHRoaXM7CiAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgb3B0aW9ucyA9IHt9OyAvLyBBdXRvIGluc3RhbGwgaWYgaXQgaXMgbm90IGRvbmUgeWV0IGFuZCBgd2luZG93YCBoYXMgYFZ1ZWAuCiAgLy8gVG8gYWxsb3cgdXNlcnMgdG8gYXZvaWQgYXV0by1pbnN0YWxsYXRpb24gaW4gc29tZSBjYXNlcywKICAvLyB0aGlzIGNvZGUgc2hvdWxkIGJlIHBsYWNlZCBoZXJlLiBTZWUgIzI5MAoKICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KCiAgaWYgKCFWdWUgJiYgdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgd2luZG93LlZ1ZSkgewogICAgaW5zdGFsbCh3aW5kb3cuVnVlKTsKICB9CgogIHZhciBsb2NhbGUgPSBvcHRpb25zLmxvY2FsZSB8fCAnZW4tVVMnOwogIHZhciBmYWxsYmFja0xvY2FsZSA9IG9wdGlvbnMuZmFsbGJhY2tMb2NhbGUgPT09IGZhbHNlID8gZmFsc2UgOiBvcHRpb25zLmZhbGxiYWNrTG9jYWxlIHx8ICdlbi1VUyc7CiAgdmFyIG1lc3NhZ2VzID0gb3B0aW9ucy5tZXNzYWdlcyB8fCB7fTsKICB2YXIgZGF0ZVRpbWVGb3JtYXRzID0gb3B0aW9ucy5kYXRlVGltZUZvcm1hdHMgfHwgb3B0aW9ucy5kYXRldGltZUZvcm1hdHMgfHwge307CiAgdmFyIG51bWJlckZvcm1hdHMgPSBvcHRpb25zLm51bWJlckZvcm1hdHMgfHwge307CiAgdGhpcy5fdm0gPSBudWxsOwogIHRoaXMuX2Zvcm1hdHRlciA9IG9wdGlvbnMuZm9ybWF0dGVyIHx8IGRlZmF1bHRGb3JtYXR0ZXI7CiAgdGhpcy5fbW9kaWZpZXJzID0gb3B0aW9ucy5tb2RpZmllcnMgfHwge307CiAgdGhpcy5fbWlzc2luZyA9IG9wdGlvbnMubWlzc2luZyB8fCBudWxsOwogIHRoaXMuX3Jvb3QgPSBvcHRpb25zLnJvb3QgfHwgbnVsbDsKICB0aGlzLl9zeW5jID0gb3B0aW9ucy5zeW5jID09PSB1bmRlZmluZWQgPyB0cnVlIDogISFvcHRpb25zLnN5bmM7CiAgdGhpcy5fZmFsbGJhY2tSb290ID0gb3B0aW9ucy5mYWxsYmFja1Jvb3QgPT09IHVuZGVmaW5lZCA/IHRydWUgOiAhIW9wdGlvbnMuZmFsbGJhY2tSb290OwogIHRoaXMuX2ZhbGxiYWNrUm9vdFdpdGhFbXB0eVN0cmluZyA9IG9wdGlvbnMuZmFsbGJhY2tSb290V2l0aEVtcHR5U3RyaW5nID09PSB1bmRlZmluZWQgPyB0cnVlIDogISFvcHRpb25zLmZhbGxiYWNrUm9vdFdpdGhFbXB0eVN0cmluZzsKICB0aGlzLl9mb3JtYXRGYWxsYmFja01lc3NhZ2VzID0gb3B0aW9ucy5mb3JtYXRGYWxsYmFja01lc3NhZ2VzID09PSB1bmRlZmluZWQgPyBmYWxzZSA6ICEhb3B0aW9ucy5mb3JtYXRGYWxsYmFja01lc3NhZ2VzOwogIHRoaXMuX3NpbGVudFRyYW5zbGF0aW9uV2FybiA9IG9wdGlvbnMuc2lsZW50VHJhbnNsYXRpb25XYXJuID09PSB1bmRlZmluZWQgPyBmYWxzZSA6IG9wdGlvbnMuc2lsZW50VHJhbnNsYXRpb25XYXJuOwogIHRoaXMuX3NpbGVudEZhbGxiYWNrV2FybiA9IG9wdGlvbnMuc2lsZW50RmFsbGJhY2tXYXJuID09PSB1bmRlZmluZWQgPyBmYWxzZSA6ICEhb3B0aW9ucy5zaWxlbnRGYWxsYmFja1dhcm47CiAgdGhpcy5fZGF0ZVRpbWVGb3JtYXR0ZXJzID0ge307CiAgdGhpcy5fbnVtYmVyRm9ybWF0dGVycyA9IHt9OwogIHRoaXMuX3BhdGggPSBuZXcgSTE4blBhdGgoKTsKICB0aGlzLl9kYXRhTGlzdGVuZXJzID0gbmV3IFNldCgpOwogIHRoaXMuX2NvbXBvbmVudEluc3RhbmNlQ3JlYXRlZExpc3RlbmVyID0gb3B0aW9ucy5jb21wb25lbnRJbnN0YW5jZUNyZWF0ZWRMaXN0ZW5lciB8fCBudWxsOwogIHRoaXMuX3ByZXNlcnZlRGlyZWN0aXZlQ29udGVudCA9IG9wdGlvbnMucHJlc2VydmVEaXJlY3RpdmVDb250ZW50ID09PSB1bmRlZmluZWQgPyBmYWxzZSA6ICEhb3B0aW9ucy5wcmVzZXJ2ZURpcmVjdGl2ZUNvbnRlbnQ7CiAgdGhpcy5wbHVyYWxpemF0aW9uUnVsZXMgPSBvcHRpb25zLnBsdXJhbGl6YXRpb25SdWxlcyB8fCB7fTsKICB0aGlzLl93YXJuSHRtbEluTWVzc2FnZSA9IG9wdGlvbnMud2Fybkh0bWxJbk1lc3NhZ2UgfHwgJ29mZic7CiAgdGhpcy5fcG9zdFRyYW5zbGF0aW9uID0gb3B0aW9ucy5wb3N0VHJhbnNsYXRpb24gfHwgbnVsbDsKICB0aGlzLl9lc2NhcGVQYXJhbWV0ZXJIdG1sID0gb3B0aW9ucy5lc2NhcGVQYXJhbWV0ZXJIdG1sIHx8IGZhbHNlOwoKICBpZiAoJ19fVlVFX0kxOE5fQlJJREdFX18nIGluIG9wdGlvbnMpIHsKICAgIHRoaXMuX19WVUVfSTE4Tl9CUklER0VfXyA9IG9wdGlvbnMuX19WVUVfSTE4Tl9CUklER0VfXzsKICB9CiAgLyoqCiAgICogQHBhcmFtIGNob2ljZSB7bnVtYmVyfSBhIGNob2ljZSBpbmRleCBnaXZlbiBieSB0aGUgaW5wdXQgdG8gJHRjOiBgJHRjKCdwYXRoLnRvLnJ1bGUnLCBjaG9pY2VJbmRleClgCiAgICogQHBhcmFtIGNob2ljZXNMZW5ndGgge251bWJlcn0gYW4gb3ZlcmFsbCBhbW91bnQgb2YgYXZhaWxhYmxlIGNob2ljZXMKICAgKiBAcmV0dXJucyBhIGZpbmFsIGNob2ljZSBpbmRleAogICovCgoKICB0aGlzLmdldENob2ljZUluZGV4ID0gZnVuY3Rpb24gKGNob2ljZSwgY2hvaWNlc0xlbmd0aCkgewogICAgdmFyIHRoaXNQcm90b3R5cGUgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YodGhpcyQxKTsKCiAgICBpZiAodGhpc1Byb3RvdHlwZSAmJiB0aGlzUHJvdG90eXBlLmdldENob2ljZUluZGV4KSB7CiAgICAgIHZhciBwcm90b3R5cGVHZXRDaG9pY2VJbmRleCA9IHRoaXNQcm90b3R5cGUuZ2V0Q2hvaWNlSW5kZXg7CiAgICAgIHJldHVybiBwcm90b3R5cGVHZXRDaG9pY2VJbmRleC5jYWxsKHRoaXMkMSwgY2hvaWNlLCBjaG9pY2VzTGVuZ3RoKTsKICAgIH0gLy8gRGVmYXVsdCAob2xkKSBnZXRDaG9pY2VJbmRleCBpbXBsZW1lbnRhdGlvbiAtIGVuZ2xpc2gtY29tcGF0aWJsZQoKCiAgICB2YXIgZGVmYXVsdEltcGwgPSBmdW5jdGlvbiAoX2Nob2ljZSwgX2Nob2ljZXNMZW5ndGgpIHsKICAgICAgX2Nob2ljZSA9IE1hdGguYWJzKF9jaG9pY2UpOwoKICAgICAgaWYgKF9jaG9pY2VzTGVuZ3RoID09PSAyKSB7CiAgICAgICAgcmV0dXJuIF9jaG9pY2UgPyBfY2hvaWNlID4gMSA/IDEgOiAwIDogMTsKICAgICAgfQoKICAgICAgcmV0dXJuIF9jaG9pY2UgPyBNYXRoLm1pbihfY2hvaWNlLCAyKSA6IDA7CiAgICB9OwoKICAgIGlmICh0aGlzJDEubG9jYWxlIGluIHRoaXMkMS5wbHVyYWxpemF0aW9uUnVsZXMpIHsKICAgICAgcmV0dXJuIHRoaXMkMS5wbHVyYWxpemF0aW9uUnVsZXNbdGhpcyQxLmxvY2FsZV0uYXBwbHkodGhpcyQxLCBbY2hvaWNlLCBjaG9pY2VzTGVuZ3RoXSk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gZGVmYXVsdEltcGwoY2hvaWNlLCBjaG9pY2VzTGVuZ3RoKTsKICAgIH0KICB9OwoKICB0aGlzLl9leGlzdCA9IGZ1bmN0aW9uIChtZXNzYWdlLCBrZXkpIHsKICAgIGlmICghbWVzc2FnZSB8fCAha2V5KSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBpZiAoIWlzTnVsbCh0aGlzJDEuX3BhdGguZ2V0UGF0aFZhbHVlKG1lc3NhZ2UsIGtleSkpKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfSAvLyBmYWxsYmFjayBmb3IgZmxhdCBrZXkKCgogICAgaWYgKG1lc3NhZ2Vba2V5XSkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICByZXR1cm4gZmFsc2U7CiAgfTsKCiAgaWYgKHRoaXMuX3dhcm5IdG1sSW5NZXNzYWdlID09PSAnd2FybicgfHwgdGhpcy5fd2Fybkh0bWxJbk1lc3NhZ2UgPT09ICdlcnJvcicpIHsKICAgIE9iamVjdC5rZXlzKG1lc3NhZ2VzKS5mb3JFYWNoKGZ1bmN0aW9uIChsb2NhbGUpIHsKICAgICAgdGhpcyQxLl9jaGVja0xvY2FsZU1lc3NhZ2UobG9jYWxlLCB0aGlzJDEuX3dhcm5IdG1sSW5NZXNzYWdlLCBtZXNzYWdlc1tsb2NhbGVdKTsKICAgIH0pOwogIH0KCiAgdGhpcy5faW5pdFZNKHsKICAgIGxvY2FsZTogbG9jYWxlLAogICAgZmFsbGJhY2tMb2NhbGU6IGZhbGxiYWNrTG9jYWxlLAogICAgbWVzc2FnZXM6IG1lc3NhZ2VzLAogICAgZGF0ZVRpbWVGb3JtYXRzOiBkYXRlVGltZUZvcm1hdHMsCiAgICBudW1iZXJGb3JtYXRzOiBudW1iZXJGb3JtYXRzCiAgfSk7Cn07Cgp2YXIgcHJvdG90eXBlQWNjZXNzb3JzID0gewogIHZtOiB7CiAgICBjb25maWd1cmFibGU6IHRydWUKICB9LAogIG1lc3NhZ2VzOiB7CiAgICBjb25maWd1cmFibGU6IHRydWUKICB9LAogIGRhdGVUaW1lRm9ybWF0czogewogICAgY29uZmlndXJhYmxlOiB0cnVlCiAgfSwKICBudW1iZXJGb3JtYXRzOiB7CiAgICBjb25maWd1cmFibGU6IHRydWUKICB9LAogIGF2YWlsYWJsZUxvY2FsZXM6IHsKICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogIH0sCiAgbG9jYWxlOiB7CiAgICBjb25maWd1cmFibGU6IHRydWUKICB9LAogIGZhbGxiYWNrTG9jYWxlOiB7CiAgICBjb25maWd1cmFibGU6IHRydWUKICB9LAogIGZvcm1hdEZhbGxiYWNrTWVzc2FnZXM6IHsKICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogIH0sCiAgbWlzc2luZzogewogICAgY29uZmlndXJhYmxlOiB0cnVlCiAgfSwKICBmb3JtYXR0ZXI6IHsKICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogIH0sCiAgc2lsZW50VHJhbnNsYXRpb25XYXJuOiB7CiAgICBjb25maWd1cmFibGU6IHRydWUKICB9LAogIHNpbGVudEZhbGxiYWNrV2FybjogewogICAgY29uZmlndXJhYmxlOiB0cnVlCiAgfSwKICBwcmVzZXJ2ZURpcmVjdGl2ZUNvbnRlbnQ6IHsKICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogIH0sCiAgd2Fybkh0bWxJbk1lc3NhZ2U6IHsKICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogIH0sCiAgcG9zdFRyYW5zbGF0aW9uOiB7CiAgICBjb25maWd1cmFibGU6IHRydWUKICB9LAogIHN5bmM6IHsKICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogIH0KfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl9jaGVja0xvY2FsZU1lc3NhZ2UgPSBmdW5jdGlvbiBfY2hlY2tMb2NhbGVNZXNzYWdlKGxvY2FsZSwgbGV2ZWwsIG1lc3NhZ2UpIHsKICB2YXIgcGF0aHMgPSBbXTsKCiAgdmFyIGZuID0gZnVuY3Rpb24gKGxldmVsLCBsb2NhbGUsIG1lc3NhZ2UsIHBhdGhzKSB7CiAgICBpZiAoaXNQbGFpbk9iamVjdChtZXNzYWdlKSkgewogICAgICBPYmplY3Qua2V5cyhtZXNzYWdlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICB2YXIgdmFsID0gbWVzc2FnZVtrZXldOwoKICAgICAgICBpZiAoaXNQbGFpbk9iamVjdCh2YWwpKSB7CiAgICAgICAgICBwYXRocy5wdXNoKGtleSk7CiAgICAgICAgICBwYXRocy5wdXNoKCcuJyk7CiAgICAgICAgICBmbihsZXZlbCwgbG9jYWxlLCB2YWwsIHBhdGhzKTsKICAgICAgICAgIHBhdGhzLnBvcCgpOwogICAgICAgICAgcGF0aHMucG9wKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHBhdGhzLnB1c2goa2V5KTsKICAgICAgICAgIGZuKGxldmVsLCBsb2NhbGUsIHZhbCwgcGF0aHMpOwogICAgICAgICAgcGF0aHMucG9wKCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0gZWxzZSBpZiAoaXNBcnJheShtZXNzYWdlKSkgewogICAgICBtZXNzYWdlLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7CiAgICAgICAgaWYgKGlzUGxhaW5PYmplY3QoaXRlbSkpIHsKICAgICAgICAgIHBhdGhzLnB1c2goIlsiICsgaW5kZXggKyAiXSIpOwogICAgICAgICAgcGF0aHMucHVzaCgnLicpOwogICAgICAgICAgZm4obGV2ZWwsIGxvY2FsZSwgaXRlbSwgcGF0aHMpOwogICAgICAgICAgcGF0aHMucG9wKCk7CiAgICAgICAgICBwYXRocy5wb3AoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcGF0aHMucHVzaCgiWyIgKyBpbmRleCArICJdIik7CiAgICAgICAgICBmbihsZXZlbCwgbG9jYWxlLCBpdGVtLCBwYXRocyk7CiAgICAgICAgICBwYXRocy5wb3AoKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSBlbHNlIGlmIChpc1N0cmluZyhtZXNzYWdlKSkgewogICAgICB2YXIgcmV0ID0gaHRtbFRhZ01hdGNoZXIudGVzdChtZXNzYWdlKTsKCiAgICAgIGlmIChyZXQpIHsKICAgICAgICB2YXIgbXNnID0gIkRldGVjdGVkIEhUTUwgaW4gbWVzc2FnZSAnIiArIG1lc3NhZ2UgKyAiJyBvZiBrZXlwYXRoICciICsgcGF0aHMuam9pbignJykgKyAiJyBhdCAnIiArIGxvY2FsZSArICInLiBDb25zaWRlciBjb21wb25lbnQgaW50ZXJwb2xhdGlvbiB3aXRoICc8aTE4bj4nIHRvIGF2b2lkIFhTUy4gU2VlIGh0dHBzOi8vYml0Lmx5LzJacUp6a3AiOwoKICAgICAgICBpZiAobGV2ZWwgPT09ICd3YXJuJykgewogICAgICAgICAgd2Fybihtc2cpOwogICAgICAgIH0gZWxzZSBpZiAobGV2ZWwgPT09ICdlcnJvcicpIHsKICAgICAgICAgIGVycm9yKG1zZyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfTsKCiAgZm4obGV2ZWwsIGxvY2FsZSwgbWVzc2FnZSwgcGF0aHMpOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX2luaXRWTSA9IGZ1bmN0aW9uIF9pbml0Vk0oZGF0YSkgewogIHZhciBzaWxlbnQgPSBWdWUuY29uZmlnLnNpbGVudDsKICBWdWUuY29uZmlnLnNpbGVudCA9IHRydWU7CiAgdGhpcy5fdm0gPSBuZXcgVnVlKHsKICAgIGRhdGE6IGRhdGEsCiAgICBfX1ZVRTE4Tl9fSU5TVEFOQ0VfXzogdHJ1ZQogIH0pOwogIFZ1ZS5jb25maWcuc2lsZW50ID0gc2lsZW50Owp9OwoKVnVlSTE4bi5wcm90b3R5cGUuZGVzdHJveVZNID0gZnVuY3Rpb24gZGVzdHJveVZNKCkgewogIHRoaXMuX3ZtLiRkZXN0cm95KCk7Cn07CgpWdWVJMThuLnByb3RvdHlwZS5zdWJzY3JpYmVEYXRhQ2hhbmdpbmcgPSBmdW5jdGlvbiBzdWJzY3JpYmVEYXRhQ2hhbmdpbmcodm0pIHsKICB0aGlzLl9kYXRhTGlzdGVuZXJzLmFkZCh2bSk7Cn07CgpWdWVJMThuLnByb3RvdHlwZS51bnN1YnNjcmliZURhdGFDaGFuZ2luZyA9IGZ1bmN0aW9uIHVuc3Vic2NyaWJlRGF0YUNoYW5naW5nKHZtKSB7CiAgcmVtb3ZlKHRoaXMuX2RhdGFMaXN0ZW5lcnMsIHZtKTsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLndhdGNoSTE4bkRhdGEgPSBmdW5jdGlvbiB3YXRjaEkxOG5EYXRhKCkgewogIHZhciB0aGlzJDEgPSB0aGlzOwogIHJldHVybiB0aGlzLl92bS4kd2F0Y2goJyRkYXRhJywgZnVuY3Rpb24gKCkgewogICAgdmFyIGxpc3RlbmVycyA9IGFycmF5RnJvbSh0aGlzJDEuX2RhdGFMaXN0ZW5lcnMpOwogICAgdmFyIGkgPSBsaXN0ZW5lcnMubGVuZ3RoOwoKICAgIHdoaWxlIChpLS0pIHsKICAgICAgVnVlLm5leHRUaWNrKGZ1bmN0aW9uICgpIHsKICAgICAgICBsaXN0ZW5lcnNbaV0gJiYgbGlzdGVuZXJzW2ldLiRmb3JjZVVwZGF0ZSgpOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBkZWVwOiB0cnVlCiAgfSk7Cn07CgpWdWVJMThuLnByb3RvdHlwZS53YXRjaExvY2FsZSA9IGZ1bmN0aW9uIHdhdGNoTG9jYWxlKGNvbXBvc2VyKSB7CiAgaWYgKCFjb21wb3NlcikgewogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgICBpZiAoIXRoaXMuX3N5bmMgfHwgIXRoaXMuX3Jvb3QpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgdmFyIHRhcmdldCA9IHRoaXMuX3ZtOwogICAgcmV0dXJuIHRoaXMuX3Jvb3QuJGkxOG4udm0uJHdhdGNoKCdsb2NhbGUnLCBmdW5jdGlvbiAodmFsKSB7CiAgICAgIHRhcmdldC4kc2V0KHRhcmdldCwgJ2xvY2FsZScsIHZhbCk7CiAgICAgIHRhcmdldC4kZm9yY2VVcGRhdGUoKTsKICAgIH0sIHsKICAgICAgaW1tZWRpYXRlOiB0cnVlCiAgICB9KTsKICB9IGVsc2UgewogICAgLy8gZGVhbCB3aXRoIHZ1ZS1pMThuLWJyaWRnZQogICAgaWYgKCF0aGlzLl9fVlVFX0kxOE5fQlJJREdFX18pIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgdmFyIHRhcmdldCQxID0gdGhpcy5fdm07CiAgICByZXR1cm4gdGhpcy52bS4kd2F0Y2goJ2xvY2FsZScsIGZ1bmN0aW9uICh2YWwpIHsKICAgICAgdGFyZ2V0JDEuJHNldCh0YXJnZXQkMSwgJ2xvY2FsZScsIHZhbCk7CgogICAgICBpZiAoc2VsZi5fX1ZVRV9JMThOX0JSSURHRV9fICYmIGNvbXBvc2VyKSB7CiAgICAgICAgY29tcG9zZXIubG9jYWxlLnZhbHVlID0gdmFsOwogICAgICB9CgogICAgICB0YXJnZXQkMS4kZm9yY2VVcGRhdGUoKTsKICAgIH0sIHsKICAgICAgaW1tZWRpYXRlOiB0cnVlCiAgICB9KTsKICB9Cn07CgpWdWVJMThuLnByb3RvdHlwZS5vbkNvbXBvbmVudEluc3RhbmNlQ3JlYXRlZCA9IGZ1bmN0aW9uIG9uQ29tcG9uZW50SW5zdGFuY2VDcmVhdGVkKG5ld0kxOG4pIHsKICBpZiAodGhpcy5fY29tcG9uZW50SW5zdGFuY2VDcmVhdGVkTGlzdGVuZXIpIHsKICAgIHRoaXMuX2NvbXBvbmVudEluc3RhbmNlQ3JlYXRlZExpc3RlbmVyKG5ld0kxOG4sIHRoaXMpOwogIH0KfTsKCnByb3RvdHlwZUFjY2Vzc29ycy52bS5nZXQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIHRoaXMuX3ZtOwp9OwoKcHJvdG90eXBlQWNjZXNzb3JzLm1lc3NhZ2VzLmdldCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gbG9vc2VDbG9uZSh0aGlzLl9nZXRNZXNzYWdlcygpKTsKfTsKCnByb3RvdHlwZUFjY2Vzc29ycy5kYXRlVGltZUZvcm1hdHMuZ2V0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBsb29zZUNsb25lKHRoaXMuX2dldERhdGVUaW1lRm9ybWF0cygpKTsKfTsKCnByb3RvdHlwZUFjY2Vzc29ycy5udW1iZXJGb3JtYXRzLmdldCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gbG9vc2VDbG9uZSh0aGlzLl9nZXROdW1iZXJGb3JtYXRzKCkpOwp9OwoKcHJvdG90eXBlQWNjZXNzb3JzLmF2YWlsYWJsZUxvY2FsZXMuZ2V0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiBPYmplY3Qua2V5cyh0aGlzLm1lc3NhZ2VzKS5zb3J0KCk7Cn07Cgpwcm90b3R5cGVBY2Nlc3NvcnMubG9jYWxlLmdldCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gdGhpcy5fdm0ubG9jYWxlOwp9OwoKcHJvdG90eXBlQWNjZXNzb3JzLmxvY2FsZS5zZXQgPSBmdW5jdGlvbiAobG9jYWxlKSB7CiAgdGhpcy5fdm0uJHNldCh0aGlzLl92bSwgJ2xvY2FsZScsIGxvY2FsZSk7Cn07Cgpwcm90b3R5cGVBY2Nlc3NvcnMuZmFsbGJhY2tMb2NhbGUuZ2V0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiB0aGlzLl92bS5mYWxsYmFja0xvY2FsZTsKfTsKCnByb3RvdHlwZUFjY2Vzc29ycy5mYWxsYmFja0xvY2FsZS5zZXQgPSBmdW5jdGlvbiAobG9jYWxlKSB7CiAgdGhpcy5fbG9jYWxlQ2hhaW5DYWNoZSA9IHt9OwoKICB0aGlzLl92bS4kc2V0KHRoaXMuX3ZtLCAnZmFsbGJhY2tMb2NhbGUnLCBsb2NhbGUpOwp9OwoKcHJvdG90eXBlQWNjZXNzb3JzLmZvcm1hdEZhbGxiYWNrTWVzc2FnZXMuZ2V0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiB0aGlzLl9mb3JtYXRGYWxsYmFja01lc3NhZ2VzOwp9OwoKcHJvdG90eXBlQWNjZXNzb3JzLmZvcm1hdEZhbGxiYWNrTWVzc2FnZXMuc2V0ID0gZnVuY3Rpb24gKGZhbGxiYWNrKSB7CiAgdGhpcy5fZm9ybWF0RmFsbGJhY2tNZXNzYWdlcyA9IGZhbGxiYWNrOwp9OwoKcHJvdG90eXBlQWNjZXNzb3JzLm1pc3NpbmcuZ2V0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiB0aGlzLl9taXNzaW5nOwp9OwoKcHJvdG90eXBlQWNjZXNzb3JzLm1pc3Npbmcuc2V0ID0gZnVuY3Rpb24gKGhhbmRsZXIpIHsKICB0aGlzLl9taXNzaW5nID0gaGFuZGxlcjsKfTsKCnByb3RvdHlwZUFjY2Vzc29ycy5mb3JtYXR0ZXIuZ2V0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiB0aGlzLl9mb3JtYXR0ZXI7Cn07Cgpwcm90b3R5cGVBY2Nlc3NvcnMuZm9ybWF0dGVyLnNldCA9IGZ1bmN0aW9uIChmb3JtYXR0ZXIpIHsKICB0aGlzLl9mb3JtYXR0ZXIgPSBmb3JtYXR0ZXI7Cn07Cgpwcm90b3R5cGVBY2Nlc3NvcnMuc2lsZW50VHJhbnNsYXRpb25XYXJuLmdldCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gdGhpcy5fc2lsZW50VHJhbnNsYXRpb25XYXJuOwp9OwoKcHJvdG90eXBlQWNjZXNzb3JzLnNpbGVudFRyYW5zbGF0aW9uV2Fybi5zZXQgPSBmdW5jdGlvbiAoc2lsZW50KSB7CiAgdGhpcy5fc2lsZW50VHJhbnNsYXRpb25XYXJuID0gc2lsZW50Owp9OwoKcHJvdG90eXBlQWNjZXNzb3JzLnNpbGVudEZhbGxiYWNrV2Fybi5nZXQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIHRoaXMuX3NpbGVudEZhbGxiYWNrV2FybjsKfTsKCnByb3RvdHlwZUFjY2Vzc29ycy5zaWxlbnRGYWxsYmFja1dhcm4uc2V0ID0gZnVuY3Rpb24gKHNpbGVudCkgewogIHRoaXMuX3NpbGVudEZhbGxiYWNrV2FybiA9IHNpbGVudDsKfTsKCnByb3RvdHlwZUFjY2Vzc29ycy5wcmVzZXJ2ZURpcmVjdGl2ZUNvbnRlbnQuZ2V0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiB0aGlzLl9wcmVzZXJ2ZURpcmVjdGl2ZUNvbnRlbnQ7Cn07Cgpwcm90b3R5cGVBY2Nlc3NvcnMucHJlc2VydmVEaXJlY3RpdmVDb250ZW50LnNldCA9IGZ1bmN0aW9uIChwcmVzZXJ2ZSkgewogIHRoaXMuX3ByZXNlcnZlRGlyZWN0aXZlQ29udGVudCA9IHByZXNlcnZlOwp9OwoKcHJvdG90eXBlQWNjZXNzb3JzLndhcm5IdG1sSW5NZXNzYWdlLmdldCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gdGhpcy5fd2Fybkh0bWxJbk1lc3NhZ2U7Cn07Cgpwcm90b3R5cGVBY2Nlc3NvcnMud2Fybkh0bWxJbk1lc3NhZ2Uuc2V0ID0gZnVuY3Rpb24gKGxldmVsKSB7CiAgdmFyIHRoaXMkMSA9IHRoaXM7CiAgdmFyIG9yZ0xldmVsID0gdGhpcy5fd2Fybkh0bWxJbk1lc3NhZ2U7CiAgdGhpcy5fd2Fybkh0bWxJbk1lc3NhZ2UgPSBsZXZlbDsKCiAgaWYgKG9yZ0xldmVsICE9PSBsZXZlbCAmJiAobGV2ZWwgPT09ICd3YXJuJyB8fCBsZXZlbCA9PT0gJ2Vycm9yJykpIHsKICAgIHZhciBtZXNzYWdlcyA9IHRoaXMuX2dldE1lc3NhZ2VzKCk7CgogICAgT2JqZWN0LmtleXMobWVzc2FnZXMpLmZvckVhY2goZnVuY3Rpb24gKGxvY2FsZSkgewogICAgICB0aGlzJDEuX2NoZWNrTG9jYWxlTWVzc2FnZShsb2NhbGUsIHRoaXMkMS5fd2Fybkh0bWxJbk1lc3NhZ2UsIG1lc3NhZ2VzW2xvY2FsZV0pOwogICAgfSk7CiAgfQp9OwoKcHJvdG90eXBlQWNjZXNzb3JzLnBvc3RUcmFuc2xhdGlvbi5nZXQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIHRoaXMuX3Bvc3RUcmFuc2xhdGlvbjsKfTsKCnByb3RvdHlwZUFjY2Vzc29ycy5wb3N0VHJhbnNsYXRpb24uc2V0ID0gZnVuY3Rpb24gKGhhbmRsZXIpIHsKICB0aGlzLl9wb3N0VHJhbnNsYXRpb24gPSBoYW5kbGVyOwp9OwoKcHJvdG90eXBlQWNjZXNzb3JzLnN5bmMuZ2V0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiB0aGlzLl9zeW5jOwp9OwoKcHJvdG90eXBlQWNjZXNzb3JzLnN5bmMuc2V0ID0gZnVuY3Rpb24gKHZhbCkgewogIHRoaXMuX3N5bmMgPSB2YWw7Cn07CgpWdWVJMThuLnByb3RvdHlwZS5fZ2V0TWVzc2FnZXMgPSBmdW5jdGlvbiBfZ2V0TWVzc2FnZXMoKSB7CiAgcmV0dXJuIHRoaXMuX3ZtLm1lc3NhZ2VzOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX2dldERhdGVUaW1lRm9ybWF0cyA9IGZ1bmN0aW9uIF9nZXREYXRlVGltZUZvcm1hdHMoKSB7CiAgcmV0dXJuIHRoaXMuX3ZtLmRhdGVUaW1lRm9ybWF0czsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl9nZXROdW1iZXJGb3JtYXRzID0gZnVuY3Rpb24gX2dldE51bWJlckZvcm1hdHMoKSB7CiAgcmV0dXJuIHRoaXMuX3ZtLm51bWJlckZvcm1hdHM7Cn07CgpWdWVJMThuLnByb3RvdHlwZS5fd2FybkRlZmF1bHQgPSBmdW5jdGlvbiBfd2FybkRlZmF1bHQobG9jYWxlLCBrZXksIHJlc3VsdCwgdm0sIHZhbHVlcywgaW50ZXJwb2xhdGVNb2RlKSB7CiAgaWYgKCFpc051bGwocmVzdWx0KSkgewogICAgcmV0dXJuIHJlc3VsdDsKICB9CgogIGlmICh0aGlzLl9taXNzaW5nKSB7CiAgICB2YXIgbWlzc2luZ1JldCA9IHRoaXMuX21pc3NpbmcuYXBwbHkobnVsbCwgW2xvY2FsZSwga2V5LCB2bSwgdmFsdWVzXSk7CgogICAgaWYgKGlzU3RyaW5nKG1pc3NpbmdSZXQpKSB7CiAgICAgIHJldHVybiBtaXNzaW5nUmV0OwogICAgfQogIH0gZWxzZSB7CiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyAmJiAhdGhpcy5faXNTaWxlbnRUcmFuc2xhdGlvbldhcm4oa2V5KSkgewogICAgICB3YXJuKCJDYW5ub3QgdHJhbnNsYXRlIHRoZSB2YWx1ZSBvZiBrZXlwYXRoICciICsga2V5ICsgIicuICIgKyAnVXNlIHRoZSB2YWx1ZSBvZiBrZXlwYXRoIGFzIGRlZmF1bHQuJyk7CiAgICB9CiAgfQoKICBpZiAodGhpcy5fZm9ybWF0RmFsbGJhY2tNZXNzYWdlcykgewogICAgdmFyIHBhcnNlZEFyZ3MgPSBwYXJzZUFyZ3MuYXBwbHkodm9pZCAwLCB2YWx1ZXMpOwogICAgcmV0dXJuIHRoaXMuX3JlbmRlcihrZXksIGludGVycG9sYXRlTW9kZSwgcGFyc2VkQXJncy5wYXJhbXMsIGtleSk7CiAgfSBlbHNlIHsKICAgIHJldHVybiBrZXk7CiAgfQp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX2lzRmFsbGJhY2tSb290ID0gZnVuY3Rpb24gX2lzRmFsbGJhY2tSb290KHZhbCkgewogIHJldHVybiAodGhpcy5fZmFsbGJhY2tSb290V2l0aEVtcHR5U3RyaW5nID8gIXZhbCA6IGlzTnVsbCh2YWwpKSAmJiAhaXNOdWxsKHRoaXMuX3Jvb3QpICYmIHRoaXMuX2ZhbGxiYWNrUm9vdDsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl9pc1NpbGVudEZhbGxiYWNrV2FybiA9IGZ1bmN0aW9uIF9pc1NpbGVudEZhbGxiYWNrV2FybihrZXkpIHsKICByZXR1cm4gdGhpcy5fc2lsZW50RmFsbGJhY2tXYXJuIGluc3RhbmNlb2YgUmVnRXhwID8gdGhpcy5fc2lsZW50RmFsbGJhY2tXYXJuLnRlc3Qoa2V5KSA6IHRoaXMuX3NpbGVudEZhbGxiYWNrV2FybjsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl9pc1NpbGVudEZhbGxiYWNrID0gZnVuY3Rpb24gX2lzU2lsZW50RmFsbGJhY2sobG9jYWxlLCBrZXkpIHsKICByZXR1cm4gdGhpcy5faXNTaWxlbnRGYWxsYmFja1dhcm4oa2V5KSAmJiAodGhpcy5faXNGYWxsYmFja1Jvb3QoKSB8fCBsb2NhbGUgIT09IHRoaXMuZmFsbGJhY2tMb2NhbGUpOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX2lzU2lsZW50VHJhbnNsYXRpb25XYXJuID0gZnVuY3Rpb24gX2lzU2lsZW50VHJhbnNsYXRpb25XYXJuKGtleSkgewogIHJldHVybiB0aGlzLl9zaWxlbnRUcmFuc2xhdGlvbldhcm4gaW5zdGFuY2VvZiBSZWdFeHAgPyB0aGlzLl9zaWxlbnRUcmFuc2xhdGlvbldhcm4udGVzdChrZXkpIDogdGhpcy5fc2lsZW50VHJhbnNsYXRpb25XYXJuOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX2ludGVycG9sYXRlID0gZnVuY3Rpb24gX2ludGVycG9sYXRlKGxvY2FsZSwgbWVzc2FnZSwga2V5LCBob3N0LCBpbnRlcnBvbGF0ZU1vZGUsIHZhbHVlcywgdmlzaXRlZExpbmtTdGFjaykgewogIGlmICghbWVzc2FnZSkgewogICAgcmV0dXJuIG51bGw7CiAgfQoKICB2YXIgcGF0aFJldCA9IHRoaXMuX3BhdGguZ2V0UGF0aFZhbHVlKG1lc3NhZ2UsIGtleSk7CgogIGlmIChpc0FycmF5KHBhdGhSZXQpIHx8IGlzUGxhaW5PYmplY3QocGF0aFJldCkpIHsKICAgIHJldHVybiBwYXRoUmV0OwogIH0KCiAgdmFyIHJldDsKCiAgaWYgKGlzTnVsbChwYXRoUmV0KSkgewogICAgLyogaXN0YW5idWwgaWdub3JlIGVsc2UgKi8KICAgIGlmIChpc1BsYWluT2JqZWN0KG1lc3NhZ2UpKSB7CiAgICAgIHJldCA9IG1lc3NhZ2Vba2V5XTsKCiAgICAgIGlmICghKGlzU3RyaW5nKHJldCkgfHwgaXNGdW5jdGlvbihyZXQpKSkgewogICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nICYmICF0aGlzLl9pc1NpbGVudFRyYW5zbGF0aW9uV2FybihrZXkpICYmICF0aGlzLl9pc1NpbGVudEZhbGxiYWNrKGxvY2FsZSwga2V5KSkgewogICAgICAgICAgd2FybigiVmFsdWUgb2Yga2V5ICciICsga2V5ICsgIicgaXMgbm90IGEgc3RyaW5nIG9yIGZ1bmN0aW9uICEiKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICB9IGVsc2UgewogICAgLyogaXN0YW5idWwgaWdub3JlIGVsc2UgKi8KICAgIGlmIChpc1N0cmluZyhwYXRoUmV0KSB8fCBpc0Z1bmN0aW9uKHBhdGhSZXQpKSB7CiAgICAgIHJldCA9IHBhdGhSZXQ7CiAgICB9IGVsc2UgewogICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyAmJiAhdGhpcy5faXNTaWxlbnRUcmFuc2xhdGlvbldhcm4oa2V5KSAmJiAhdGhpcy5faXNTaWxlbnRGYWxsYmFjayhsb2NhbGUsIGtleSkpIHsKICAgICAgICB3YXJuKCJWYWx1ZSBvZiBrZXkgJyIgKyBrZXkgKyAiJyBpcyBub3QgYSBzdHJpbmcgb3IgZnVuY3Rpb24hIik7CiAgICAgIH0KCiAgICAgIHJldHVybiBudWxsOwogICAgfQogIH0gLy8gQ2hlY2sgZm9yIHRoZSBleGlzdGVuY2Ugb2YgbGlua3Mgd2l0aGluIHRoZSB0cmFuc2xhdGVkIHN0cmluZwoKCiAgaWYgKGlzU3RyaW5nKHJldCkgJiYgKHJldC5pbmRleE9mKCdAOicpID49IDAgfHwgcmV0LmluZGV4T2YoJ0AuJykgPj0gMCkpIHsKICAgIHJldCA9IHRoaXMuX2xpbmsobG9jYWxlLCBtZXNzYWdlLCByZXQsIGhvc3QsICdyYXcnLCB2YWx1ZXMsIHZpc2l0ZWRMaW5rU3RhY2spOwogIH0KCiAgcmV0dXJuIHRoaXMuX3JlbmRlcihyZXQsIGludGVycG9sYXRlTW9kZSwgdmFsdWVzLCBrZXkpOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX2xpbmsgPSBmdW5jdGlvbiBfbGluayhsb2NhbGUsIG1lc3NhZ2UsIHN0ciwgaG9zdCwgaW50ZXJwb2xhdGVNb2RlLCB2YWx1ZXMsIHZpc2l0ZWRMaW5rU3RhY2spIHsKICB2YXIgcmV0ID0gc3RyOyAvLyBNYXRjaCBhbGwgdGhlIGxpbmtzIHdpdGhpbiB0aGUgbG9jYWwKICAvLyBXZSBhcmUgZ29pbmcgdG8gcmVwbGFjZSBlYWNoIG9mCiAgLy8gdGhlbSB3aXRoIGl0cyB0cmFuc2xhdGlvbgoKICB2YXIgbWF0Y2hlcyA9IHJldC5tYXRjaChsaW5rS2V5TWF0Y2hlcik7IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1hdXRvZml4L3ByZWZlci1jb25zdAoKICBmb3IgKHZhciBpZHggaW4gbWF0Y2hlcykgewogICAgLy8gaWUgY29tcGF0aWJsZTogZmlsdGVyIGN1c3RvbSBhcnJheQogICAgLy8gcHJvdG90eXBlIG1ldGhvZAogICAgaWYgKCFtYXRjaGVzLmhhc093blByb3BlcnR5KGlkeCkpIHsKICAgICAgY29udGludWU7CiAgICB9CgogICAgdmFyIGxpbmsgPSBtYXRjaGVzW2lkeF07CiAgICB2YXIgbGlua0tleVByZWZpeE1hdGNoZXMgPSBsaW5rLm1hdGNoKGxpbmtLZXlQcmVmaXhNYXRjaGVyKTsKICAgIHZhciBsaW5rUHJlZml4ID0gbGlua0tleVByZWZpeE1hdGNoZXNbMF07CiAgICB2YXIgZm9ybWF0dGVyTmFtZSA9IGxpbmtLZXlQcmVmaXhNYXRjaGVzWzFdOyAvLyBSZW1vdmUgdGhlIGxlYWRpbmcgQDosIEAuY2FzZTogYW5kIHRoZSBicmFja2V0cwoKICAgIHZhciBsaW5rUGxhY2Vob2xkZXIgPSBsaW5rLnJlcGxhY2UobGlua1ByZWZpeCwgJycpLnJlcGxhY2UoYnJhY2tldHNNYXRjaGVyLCAnJyk7CgogICAgaWYgKGluY2x1ZGVzKHZpc2l0ZWRMaW5rU3RhY2ssIGxpbmtQbGFjZWhvbGRlcikpIHsKICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHsKICAgICAgICB3YXJuKCJDaXJjdWxhciByZWZlcmVuY2UgZm91bmQuIFwiIiArIGxpbmsgKyAiXCIgaXMgYWxyZWFkeSB2aXNpdGVkIGluIHRoZSBjaGFpbiBvZiAiICsgdmlzaXRlZExpbmtTdGFjay5yZXZlcnNlKCkuam9pbignIDwtICcpKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHJldDsKICAgIH0KCiAgICB2aXNpdGVkTGlua1N0YWNrLnB1c2gobGlua1BsYWNlaG9sZGVyKTsgLy8gVHJhbnNsYXRlIHRoZSBsaW5rCgogICAgdmFyIHRyYW5zbGF0ZWQgPSB0aGlzLl9pbnRlcnBvbGF0ZShsb2NhbGUsIG1lc3NhZ2UsIGxpbmtQbGFjZWhvbGRlciwgaG9zdCwgaW50ZXJwb2xhdGVNb2RlID09PSAncmF3JyA/ICdzdHJpbmcnIDogaW50ZXJwb2xhdGVNb2RlLCBpbnRlcnBvbGF0ZU1vZGUgPT09ICdyYXcnID8gdW5kZWZpbmVkIDogdmFsdWVzLCB2aXNpdGVkTGlua1N0YWNrKTsKCiAgICBpZiAodGhpcy5faXNGYWxsYmFja1Jvb3QodHJhbnNsYXRlZCkpIHsKICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiYgIXRoaXMuX2lzU2lsZW50VHJhbnNsYXRpb25XYXJuKGxpbmtQbGFjZWhvbGRlcikpIHsKICAgICAgICB3YXJuKCJGYWxsIGJhY2sgdG8gdHJhbnNsYXRlIHRoZSBsaW5rIHBsYWNlaG9sZGVyICciICsgbGlua1BsYWNlaG9sZGVyICsgIicgd2l0aCByb290IGxvY2FsZS4iKTsKICAgICAgfQogICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KCgogICAgICBpZiAoIXRoaXMuX3Jvb3QpIHsKICAgICAgICB0aHJvdyBFcnJvcigndW5leHBlY3RlZCBlcnJvcicpOwogICAgICB9CgogICAgICB2YXIgcm9vdCA9IHRoaXMuX3Jvb3QuJGkxOG47CiAgICAgIHRyYW5zbGF0ZWQgPSByb290Ll90cmFuc2xhdGUocm9vdC5fZ2V0TWVzc2FnZXMoKSwgcm9vdC5sb2NhbGUsIHJvb3QuZmFsbGJhY2tMb2NhbGUsIGxpbmtQbGFjZWhvbGRlciwgaG9zdCwgaW50ZXJwb2xhdGVNb2RlLCB2YWx1ZXMpOwogICAgfQoKICAgIHRyYW5zbGF0ZWQgPSB0aGlzLl93YXJuRGVmYXVsdChsb2NhbGUsIGxpbmtQbGFjZWhvbGRlciwgdHJhbnNsYXRlZCwgaG9zdCwgaXNBcnJheSh2YWx1ZXMpID8gdmFsdWVzIDogW3ZhbHVlc10sIGludGVycG9sYXRlTW9kZSk7CgogICAgaWYgKHRoaXMuX21vZGlmaWVycy5oYXNPd25Qcm9wZXJ0eShmb3JtYXR0ZXJOYW1lKSkgewogICAgICB0cmFuc2xhdGVkID0gdGhpcy5fbW9kaWZpZXJzW2Zvcm1hdHRlck5hbWVdKHRyYW5zbGF0ZWQpOwogICAgfSBlbHNlIGlmIChkZWZhdWx0TW9kaWZpZXJzLmhhc093blByb3BlcnR5KGZvcm1hdHRlck5hbWUpKSB7CiAgICAgIHRyYW5zbGF0ZWQgPSBkZWZhdWx0TW9kaWZpZXJzW2Zvcm1hdHRlck5hbWVdKHRyYW5zbGF0ZWQpOwogICAgfQoKICAgIHZpc2l0ZWRMaW5rU3RhY2sucG9wKCk7IC8vIFJlcGxhY2UgdGhlIGxpbmsgd2l0aCB0aGUgdHJhbnNsYXRlZAoKICAgIHJldCA9ICF0cmFuc2xhdGVkID8gcmV0IDogcmV0LnJlcGxhY2UobGluaywgdHJhbnNsYXRlZCk7CiAgfQoKICByZXR1cm4gcmV0Owp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX2NyZWF0ZU1lc3NhZ2VDb250ZXh0ID0gZnVuY3Rpb24gX2NyZWF0ZU1lc3NhZ2VDb250ZXh0KHZhbHVlcywgZm9ybWF0dGVyLCBwYXRoLCBpbnRlcnBvbGF0ZU1vZGUpIHsKICB2YXIgdGhpcyQxID0gdGhpczsKCiAgdmFyIF9saXN0ID0gaXNBcnJheSh2YWx1ZXMpID8gdmFsdWVzIDogW107CgogIHZhciBfbmFtZWQgPSBpc09iamVjdCh2YWx1ZXMpID8gdmFsdWVzIDoge307CgogIHZhciBsaXN0ID0gZnVuY3Rpb24gKGluZGV4KSB7CiAgICByZXR1cm4gX2xpc3RbaW5kZXhdOwogIH07CgogIHZhciBuYW1lZCA9IGZ1bmN0aW9uIChrZXkpIHsKICAgIHJldHVybiBfbmFtZWRba2V5XTsKICB9OwoKICB2YXIgbWVzc2FnZXMgPSB0aGlzLl9nZXRNZXNzYWdlcygpOwoKICB2YXIgbG9jYWxlID0gdGhpcy5sb2NhbGU7CiAgcmV0dXJuIHsKICAgIGxpc3Q6IGxpc3QsCiAgICBuYW1lZDogbmFtZWQsCiAgICB2YWx1ZXM6IHZhbHVlcywKICAgIGZvcm1hdHRlcjogZm9ybWF0dGVyLAogICAgcGF0aDogcGF0aCwKICAgIG1lc3NhZ2VzOiBtZXNzYWdlcywKICAgIGxvY2FsZTogbG9jYWxlLAogICAgbGlua2VkOiBmdW5jdGlvbiAobGlua2VkS2V5KSB7CiAgICAgIHJldHVybiB0aGlzJDEuX2ludGVycG9sYXRlKGxvY2FsZSwgbWVzc2FnZXNbbG9jYWxlXSB8fCB7fSwgbGlua2VkS2V5LCBudWxsLCBpbnRlcnBvbGF0ZU1vZGUsIHVuZGVmaW5lZCwgW2xpbmtlZEtleV0pOwogICAgfQogIH07Cn07CgpWdWVJMThuLnByb3RvdHlwZS5fcmVuZGVyID0gZnVuY3Rpb24gX3JlbmRlcihtZXNzYWdlLCBpbnRlcnBvbGF0ZU1vZGUsIHZhbHVlcywgcGF0aCkgewogIGlmIChpc0Z1bmN0aW9uKG1lc3NhZ2UpKSB7CiAgICByZXR1cm4gbWVzc2FnZSh0aGlzLl9jcmVhdGVNZXNzYWdlQ29udGV4dCh2YWx1ZXMsIHRoaXMuX2Zvcm1hdHRlciB8fCBkZWZhdWx0Rm9ybWF0dGVyLCBwYXRoLCBpbnRlcnBvbGF0ZU1vZGUpKTsKICB9CgogIHZhciByZXQgPSB0aGlzLl9mb3JtYXR0ZXIuaW50ZXJwb2xhdGUobWVzc2FnZSwgdmFsdWVzLCBwYXRoKTsgLy8gSWYgdGhlIGN1c3RvbSBmb3JtYXR0ZXIgcmVmdXNlcyB0byB3b3JrIC0gYXBwbHkgdGhlIGRlZmF1bHQgb25lCgoKICBpZiAoIXJldCkgewogICAgcmV0ID0gZGVmYXVsdEZvcm1hdHRlci5pbnRlcnBvbGF0ZShtZXNzYWdlLCB2YWx1ZXMsIHBhdGgpOwogIH0gLy8gaWYgaW50ZXJwb2xhdGVNb2RlIGlzICoqbm90KiogJ3N0cmluZycgKCdyb3cnKSwKICAvLyByZXR1cm4gdGhlIGNvbXBpbGVkIGRhdGEgKGUuZy4gWydmb28nLCBWTm9kZSwgJ2JhciddKSB3aXRoIGZvcm1hdHRlcgoKCiAgcmV0dXJuIGludGVycG9sYXRlTW9kZSA9PT0gJ3N0cmluZycgJiYgIWlzU3RyaW5nKHJldCkgPyByZXQuam9pbignJykgOiByZXQ7Cn07CgpWdWVJMThuLnByb3RvdHlwZS5fYXBwZW5kSXRlbVRvQ2hhaW4gPSBmdW5jdGlvbiBfYXBwZW5kSXRlbVRvQ2hhaW4oY2hhaW4sIGl0ZW0sIGJsb2NrcykgewogIHZhciBmb2xsb3cgPSBmYWxzZTsKCiAgaWYgKCFpbmNsdWRlcyhjaGFpbiwgaXRlbSkpIHsKICAgIGZvbGxvdyA9IHRydWU7CgogICAgaWYgKGl0ZW0pIHsKICAgICAgZm9sbG93ID0gaXRlbVtpdGVtLmxlbmd0aCAtIDFdICE9PSAnISc7CiAgICAgIGl0ZW0gPSBpdGVtLnJlcGxhY2UoLyEvZywgJycpOwogICAgICBjaGFpbi5wdXNoKGl0ZW0pOwoKICAgICAgaWYgKGJsb2NrcyAmJiBibG9ja3NbaXRlbV0pIHsKICAgICAgICBmb2xsb3cgPSBibG9ja3NbaXRlbV07CiAgICAgIH0KICAgIH0KICB9CgogIHJldHVybiBmb2xsb3c7Cn07CgpWdWVJMThuLnByb3RvdHlwZS5fYXBwZW5kTG9jYWxlVG9DaGFpbiA9IGZ1bmN0aW9uIF9hcHBlbmRMb2NhbGVUb0NoYWluKGNoYWluLCBsb2NhbGUsIGJsb2NrcykgewogIHZhciBmb2xsb3c7CiAgdmFyIHRva2VucyA9IGxvY2FsZS5zcGxpdCgnLScpOwoKICBkbyB7CiAgICB2YXIgaXRlbSA9IHRva2Vucy5qb2luKCctJyk7CiAgICBmb2xsb3cgPSB0aGlzLl9hcHBlbmRJdGVtVG9DaGFpbihjaGFpbiwgaXRlbSwgYmxvY2tzKTsKICAgIHRva2Vucy5zcGxpY2UoLTEsIDEpOwogIH0gd2hpbGUgKHRva2Vucy5sZW5ndGggJiYgZm9sbG93ID09PSB0cnVlKTsKCiAgcmV0dXJuIGZvbGxvdzsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl9hcHBlbmRCbG9ja1RvQ2hhaW4gPSBmdW5jdGlvbiBfYXBwZW5kQmxvY2tUb0NoYWluKGNoYWluLCBibG9jaywgYmxvY2tzKSB7CiAgdmFyIGZvbGxvdyA9IHRydWU7CgogIGZvciAodmFyIGkgPSAwOyBpIDwgYmxvY2subGVuZ3RoICYmIGlzQm9vbGVhbihmb2xsb3cpOyBpKyspIHsKICAgIHZhciBsb2NhbGUgPSBibG9ja1tpXTsKCiAgICBpZiAoaXNTdHJpbmcobG9jYWxlKSkgewogICAgICBmb2xsb3cgPSB0aGlzLl9hcHBlbmRMb2NhbGVUb0NoYWluKGNoYWluLCBsb2NhbGUsIGJsb2Nrcyk7CiAgICB9CiAgfQoKICByZXR1cm4gZm9sbG93Owp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX2dldExvY2FsZUNoYWluID0gZnVuY3Rpb24gX2dldExvY2FsZUNoYWluKHN0YXJ0LCBmYWxsYmFja0xvY2FsZSkgewogIGlmIChzdGFydCA9PT0gJycpIHsKICAgIHJldHVybiBbXTsKICB9CgogIGlmICghdGhpcy5fbG9jYWxlQ2hhaW5DYWNoZSkgewogICAgdGhpcy5fbG9jYWxlQ2hhaW5DYWNoZSA9IHt9OwogIH0KCiAgdmFyIGNoYWluID0gdGhpcy5fbG9jYWxlQ2hhaW5DYWNoZVtzdGFydF07CgogIGlmICghY2hhaW4pIHsKICAgIGlmICghZmFsbGJhY2tMb2NhbGUpIHsKICAgICAgZmFsbGJhY2tMb2NhbGUgPSB0aGlzLmZhbGxiYWNrTG9jYWxlOwogICAgfQoKICAgIGNoYWluID0gW107IC8vIGZpcnN0IGJsb2NrIGRlZmluZWQgYnkgc3RhcnQKCiAgICB2YXIgYmxvY2sgPSBbc3RhcnRdOyAvLyB3aGlsZSBhbnkgaW50ZXJ2ZW5pbmcgYmxvY2sgZm91bmQKCiAgICB3aGlsZSAoaXNBcnJheShibG9jaykpIHsKICAgICAgYmxvY2sgPSB0aGlzLl9hcHBlbmRCbG9ja1RvQ2hhaW4oY2hhaW4sIGJsb2NrLCBmYWxsYmFja0xvY2FsZSk7CiAgICB9IC8vIGxhc3QgYmxvY2sgZGVmaW5lZCBieSBkZWZhdWx0CgoKICAgIHZhciBkZWZhdWx0czsKCiAgICBpZiAoaXNBcnJheShmYWxsYmFja0xvY2FsZSkpIHsKICAgICAgZGVmYXVsdHMgPSBmYWxsYmFja0xvY2FsZTsKICAgIH0gZWxzZSBpZiAoaXNPYmplY3QoZmFsbGJhY2tMb2NhbGUpKSB7CiAgICAgIC8qICRGbG93Rml4TWUgKi8KICAgICAgaWYgKGZhbGxiYWNrTG9jYWxlWydkZWZhdWx0J10pIHsKICAgICAgICBkZWZhdWx0cyA9IGZhbGxiYWNrTG9jYWxlWydkZWZhdWx0J107CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGVmYXVsdHMgPSBudWxsOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBkZWZhdWx0cyA9IGZhbGxiYWNrTG9jYWxlOwogICAgfSAvLyBjb252ZXJ0IGRlZmF1bHRzIHRvIGFycmF5CgoKICAgIGlmIChpc1N0cmluZyhkZWZhdWx0cykpIHsKICAgICAgYmxvY2sgPSBbZGVmYXVsdHNdOwogICAgfSBlbHNlIHsKICAgICAgYmxvY2sgPSBkZWZhdWx0czsKICAgIH0KCiAgICBpZiAoYmxvY2spIHsKICAgICAgdGhpcy5fYXBwZW5kQmxvY2tUb0NoYWluKGNoYWluLCBibG9jaywgbnVsbCk7CiAgICB9CgogICAgdGhpcy5fbG9jYWxlQ2hhaW5DYWNoZVtzdGFydF0gPSBjaGFpbjsKICB9CgogIHJldHVybiBjaGFpbjsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl90cmFuc2xhdGUgPSBmdW5jdGlvbiBfdHJhbnNsYXRlKG1lc3NhZ2VzLCBsb2NhbGUsIGZhbGxiYWNrLCBrZXksIGhvc3QsIGludGVycG9sYXRlTW9kZSwgYXJncykgewogIHZhciBjaGFpbiA9IHRoaXMuX2dldExvY2FsZUNoYWluKGxvY2FsZSwgZmFsbGJhY2spOwoKICB2YXIgcmVzOwoKICBmb3IgKHZhciBpID0gMDsgaSA8IGNoYWluLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgc3RlcCA9IGNoYWluW2ldOwogICAgcmVzID0gdGhpcy5faW50ZXJwb2xhdGUoc3RlcCwgbWVzc2FnZXNbc3RlcF0sIGtleSwgaG9zdCwgaW50ZXJwb2xhdGVNb2RlLCBhcmdzLCBba2V5XSk7CgogICAgaWYgKCFpc051bGwocmVzKSkgewogICAgICBpZiAoc3RlcCAhPT0gbG9jYWxlICYmIHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiYgIXRoaXMuX2lzU2lsZW50VHJhbnNsYXRpb25XYXJuKGtleSkgJiYgIXRoaXMuX2lzU2lsZW50RmFsbGJhY2tXYXJuKGtleSkpIHsKICAgICAgICB3YXJuKCJGYWxsIGJhY2sgdG8gdHJhbnNsYXRlIHRoZSBrZXlwYXRoICciICsga2V5ICsgIicgd2l0aCAnIiArIHN0ZXAgKyAiJyBsb2NhbGUuIik7CiAgICAgIH0KCiAgICAgIHJldHVybiByZXM7CiAgICB9CiAgfQoKICByZXR1cm4gbnVsbDsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl90ID0gZnVuY3Rpb24gX3Qoa2V5LCBfbG9jYWxlLCBtZXNzYWdlcywgaG9zdCkgewogIHZhciByZWY7CiAgdmFyIHZhbHVlcyA9IFtdLAogICAgICBsZW4gPSBhcmd1bWVudHMubGVuZ3RoIC0gNDsKCiAgd2hpbGUgKGxlbi0tID4gMCkgdmFsdWVzW2xlbl0gPSBhcmd1bWVudHNbbGVuICsgNF07CgogIGlmICgha2V5KSB7CiAgICByZXR1cm4gJyc7CiAgfQoKICB2YXIgcGFyc2VkQXJncyA9IHBhcnNlQXJncy5hcHBseSh2b2lkIDAsIHZhbHVlcyk7CgogIGlmICh0aGlzLl9lc2NhcGVQYXJhbWV0ZXJIdG1sKSB7CiAgICBwYXJzZWRBcmdzLnBhcmFtcyA9IGVzY2FwZVBhcmFtcyhwYXJzZWRBcmdzLnBhcmFtcyk7CiAgfQoKICB2YXIgbG9jYWxlID0gcGFyc2VkQXJncy5sb2NhbGUgfHwgX2xvY2FsZTsKCiAgdmFyIHJldCA9IHRoaXMuX3RyYW5zbGF0ZShtZXNzYWdlcywgbG9jYWxlLCB0aGlzLmZhbGxiYWNrTG9jYWxlLCBrZXksIGhvc3QsICdzdHJpbmcnLCBwYXJzZWRBcmdzLnBhcmFtcyk7CgogIGlmICh0aGlzLl9pc0ZhbGxiYWNrUm9vdChyZXQpKSB7CiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyAmJiAhdGhpcy5faXNTaWxlbnRUcmFuc2xhdGlvbldhcm4oa2V5KSAmJiAhdGhpcy5faXNTaWxlbnRGYWxsYmFja1dhcm4oa2V5KSkgewogICAgICB3YXJuKCJGYWxsIGJhY2sgdG8gdHJhbnNsYXRlIHRoZSBrZXlwYXRoICciICsga2V5ICsgIicgd2l0aCByb290IGxvY2FsZS4iKTsKICAgIH0KICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwoKCiAgICBpZiAoIXRoaXMuX3Jvb3QpIHsKICAgICAgdGhyb3cgRXJyb3IoJ3VuZXhwZWN0ZWQgZXJyb3InKTsKICAgIH0KCiAgICByZXR1cm4gKHJlZiA9IHRoaXMuX3Jvb3QpLiR0LmFwcGx5KHJlZiwgW2tleV0uY29uY2F0KHZhbHVlcykpOwogIH0gZWxzZSB7CiAgICByZXQgPSB0aGlzLl93YXJuRGVmYXVsdChsb2NhbGUsIGtleSwgcmV0LCBob3N0LCB2YWx1ZXMsICdzdHJpbmcnKTsKCiAgICBpZiAodGhpcy5fcG9zdFRyYW5zbGF0aW9uICYmIHJldCAhPT0gbnVsbCAmJiByZXQgIT09IHVuZGVmaW5lZCkgewogICAgICByZXQgPSB0aGlzLl9wb3N0VHJhbnNsYXRpb24ocmV0LCBrZXkpOwogICAgfQoKICAgIHJldHVybiByZXQ7CiAgfQp9OwoKVnVlSTE4bi5wcm90b3R5cGUudCA9IGZ1bmN0aW9uIHQoa2V5KSB7CiAgdmFyIHJlZjsKICB2YXIgdmFsdWVzID0gW10sCiAgICAgIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGggLSAxOwoKICB3aGlsZSAobGVuLS0gPiAwKSB2YWx1ZXNbbGVuXSA9IGFyZ3VtZW50c1tsZW4gKyAxXTsKCiAgcmV0dXJuIChyZWYgPSB0aGlzKS5fdC5hcHBseShyZWYsIFtrZXksIHRoaXMubG9jYWxlLCB0aGlzLl9nZXRNZXNzYWdlcygpLCBudWxsXS5jb25jYXQodmFsdWVzKSk7Cn07CgpWdWVJMThuLnByb3RvdHlwZS5faSA9IGZ1bmN0aW9uIF9pKGtleSwgbG9jYWxlLCBtZXNzYWdlcywgaG9zdCwgdmFsdWVzKSB7CiAgdmFyIHJldCA9IHRoaXMuX3RyYW5zbGF0ZShtZXNzYWdlcywgbG9jYWxlLCB0aGlzLmZhbGxiYWNrTG9jYWxlLCBrZXksIGhvc3QsICdyYXcnLCB2YWx1ZXMpOwoKICBpZiAodGhpcy5faXNGYWxsYmFja1Jvb3QocmV0KSkgewogICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiYgIXRoaXMuX2lzU2lsZW50VHJhbnNsYXRpb25XYXJuKGtleSkpIHsKICAgICAgd2FybigiRmFsbCBiYWNrIHRvIGludGVycG9sYXRlIHRoZSBrZXlwYXRoICciICsga2V5ICsgIicgd2l0aCByb290IGxvY2FsZS4iKTsKICAgIH0KCiAgICBpZiAoIXRoaXMuX3Jvb3QpIHsKICAgICAgdGhyb3cgRXJyb3IoJ3VuZXhwZWN0ZWQgZXJyb3InKTsKICAgIH0KCiAgICByZXR1cm4gdGhpcy5fcm9vdC4kaTE4bi5pKGtleSwgbG9jYWxlLCB2YWx1ZXMpOwogIH0gZWxzZSB7CiAgICByZXR1cm4gdGhpcy5fd2FybkRlZmF1bHQobG9jYWxlLCBrZXksIHJldCwgaG9zdCwgW3ZhbHVlc10sICdyYXcnKTsKICB9Cn07CgpWdWVJMThuLnByb3RvdHlwZS5pID0gZnVuY3Rpb24gaShrZXksIGxvY2FsZSwgdmFsdWVzKSB7CiAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgaWYgKCFrZXkpIHsKICAgIHJldHVybiAnJzsKICB9CgogIGlmICghaXNTdHJpbmcobG9jYWxlKSkgewogICAgbG9jYWxlID0gdGhpcy5sb2NhbGU7CiAgfQoKICByZXR1cm4gdGhpcy5faShrZXksIGxvY2FsZSwgdGhpcy5fZ2V0TWVzc2FnZXMoKSwgbnVsbCwgdmFsdWVzKTsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl90YyA9IGZ1bmN0aW9uIF90YyhrZXksIF9sb2NhbGUsIG1lc3NhZ2VzLCBob3N0LCBjaG9pY2UpIHsKICB2YXIgcmVmOwogIHZhciB2YWx1ZXMgPSBbXSwKICAgICAgbGVuID0gYXJndW1lbnRzLmxlbmd0aCAtIDU7CgogIHdoaWxlIChsZW4tLSA+IDApIHZhbHVlc1tsZW5dID0gYXJndW1lbnRzW2xlbiArIDVdOwoKICBpZiAoIWtleSkgewogICAgcmV0dXJuICcnOwogIH0KCiAgaWYgKGNob2ljZSA9PT0gdW5kZWZpbmVkKSB7CiAgICBjaG9pY2UgPSAxOwogIH0KCiAgdmFyIHByZWRlZmluZWQgPSB7CiAgICAnY291bnQnOiBjaG9pY2UsCiAgICAnbic6IGNob2ljZQogIH07CiAgdmFyIHBhcnNlZEFyZ3MgPSBwYXJzZUFyZ3MuYXBwbHkodm9pZCAwLCB2YWx1ZXMpOwogIHBhcnNlZEFyZ3MucGFyYW1zID0gT2JqZWN0LmFzc2lnbihwcmVkZWZpbmVkLCBwYXJzZWRBcmdzLnBhcmFtcyk7CiAgdmFsdWVzID0gcGFyc2VkQXJncy5sb2NhbGUgPT09IG51bGwgPyBbcGFyc2VkQXJncy5wYXJhbXNdIDogW3BhcnNlZEFyZ3MubG9jYWxlLCBwYXJzZWRBcmdzLnBhcmFtc107CiAgcmV0dXJuIHRoaXMuZmV0Y2hDaG9pY2UoKHJlZiA9IHRoaXMpLl90LmFwcGx5KHJlZiwgW2tleSwgX2xvY2FsZSwgbWVzc2FnZXMsIGhvc3RdLmNvbmNhdCh2YWx1ZXMpKSwgY2hvaWNlKTsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLmZldGNoQ2hvaWNlID0gZnVuY3Rpb24gZmV0Y2hDaG9pY2UobWVzc2FnZSwgY2hvaWNlKSB7CiAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgaWYgKCFtZXNzYWdlIHx8ICFpc1N0cmluZyhtZXNzYWdlKSkgewogICAgcmV0dXJuIG51bGw7CiAgfQoKICB2YXIgY2hvaWNlcyA9IG1lc3NhZ2Uuc3BsaXQoJ3wnKTsKICBjaG9pY2UgPSB0aGlzLmdldENob2ljZUluZGV4KGNob2ljZSwgY2hvaWNlcy5sZW5ndGgpOwoKICBpZiAoIWNob2ljZXNbY2hvaWNlXSkgewogICAgcmV0dXJuIG1lc3NhZ2U7CiAgfQoKICByZXR1cm4gY2hvaWNlc1tjaG9pY2VdLnRyaW0oKTsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLnRjID0gZnVuY3Rpb24gdGMoa2V5LCBjaG9pY2UpIHsKICB2YXIgcmVmOwogIHZhciB2YWx1ZXMgPSBbXSwKICAgICAgbGVuID0gYXJndW1lbnRzLmxlbmd0aCAtIDI7CgogIHdoaWxlIChsZW4tLSA+IDApIHZhbHVlc1tsZW5dID0gYXJndW1lbnRzW2xlbiArIDJdOwoKICByZXR1cm4gKHJlZiA9IHRoaXMpLl90Yy5hcHBseShyZWYsIFtrZXksIHRoaXMubG9jYWxlLCB0aGlzLl9nZXRNZXNzYWdlcygpLCBudWxsLCBjaG9pY2VdLmNvbmNhdCh2YWx1ZXMpKTsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl90ZSA9IGZ1bmN0aW9uIF90ZShrZXksIGxvY2FsZSwgbWVzc2FnZXMpIHsKICB2YXIgYXJncyA9IFtdLAogICAgICBsZW4gPSBhcmd1bWVudHMubGVuZ3RoIC0gMzsKCiAgd2hpbGUgKGxlbi0tID4gMCkgYXJnc1tsZW5dID0gYXJndW1lbnRzW2xlbiArIDNdOwoKICB2YXIgX2xvY2FsZSA9IHBhcnNlQXJncy5hcHBseSh2b2lkIDAsIGFyZ3MpLmxvY2FsZSB8fCBsb2NhbGU7CgogIHJldHVybiB0aGlzLl9leGlzdChtZXNzYWdlc1tfbG9jYWxlXSwga2V5KTsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLnRlID0gZnVuY3Rpb24gdGUoa2V5LCBsb2NhbGUpIHsKICByZXR1cm4gdGhpcy5fdGUoa2V5LCB0aGlzLmxvY2FsZSwgdGhpcy5fZ2V0TWVzc2FnZXMoKSwgbG9jYWxlKTsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLmdldExvY2FsZU1lc3NhZ2UgPSBmdW5jdGlvbiBnZXRMb2NhbGVNZXNzYWdlKGxvY2FsZSkgewogIHJldHVybiBsb29zZUNsb25lKHRoaXMuX3ZtLm1lc3NhZ2VzW2xvY2FsZV0gfHwge30pOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUuc2V0TG9jYWxlTWVzc2FnZSA9IGZ1bmN0aW9uIHNldExvY2FsZU1lc3NhZ2UobG9jYWxlLCBtZXNzYWdlKSB7CiAgaWYgKHRoaXMuX3dhcm5IdG1sSW5NZXNzYWdlID09PSAnd2FybicgfHwgdGhpcy5fd2Fybkh0bWxJbk1lc3NhZ2UgPT09ICdlcnJvcicpIHsKICAgIHRoaXMuX2NoZWNrTG9jYWxlTWVzc2FnZShsb2NhbGUsIHRoaXMuX3dhcm5IdG1sSW5NZXNzYWdlLCBtZXNzYWdlKTsKICB9CgogIHRoaXMuX3ZtLiRzZXQodGhpcy5fdm0ubWVzc2FnZXMsIGxvY2FsZSwgbWVzc2FnZSk7Cn07CgpWdWVJMThuLnByb3RvdHlwZS5tZXJnZUxvY2FsZU1lc3NhZ2UgPSBmdW5jdGlvbiBtZXJnZUxvY2FsZU1lc3NhZ2UobG9jYWxlLCBtZXNzYWdlKSB7CiAgaWYgKHRoaXMuX3dhcm5IdG1sSW5NZXNzYWdlID09PSAnd2FybicgfHwgdGhpcy5fd2Fybkh0bWxJbk1lc3NhZ2UgPT09ICdlcnJvcicpIHsKICAgIHRoaXMuX2NoZWNrTG9jYWxlTWVzc2FnZShsb2NhbGUsIHRoaXMuX3dhcm5IdG1sSW5NZXNzYWdlLCBtZXNzYWdlKTsKICB9CgogIHRoaXMuX3ZtLiRzZXQodGhpcy5fdm0ubWVzc2FnZXMsIGxvY2FsZSwgbWVyZ2UodHlwZW9mIHRoaXMuX3ZtLm1lc3NhZ2VzW2xvY2FsZV0gIT09ICd1bmRlZmluZWQnICYmIE9iamVjdC5rZXlzKHRoaXMuX3ZtLm1lc3NhZ2VzW2xvY2FsZV0pLmxlbmd0aCA/IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuX3ZtLm1lc3NhZ2VzW2xvY2FsZV0pIDoge30sIG1lc3NhZ2UpKTsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLmdldERhdGVUaW1lRm9ybWF0ID0gZnVuY3Rpb24gZ2V0RGF0ZVRpbWVGb3JtYXQobG9jYWxlKSB7CiAgcmV0dXJuIGxvb3NlQ2xvbmUodGhpcy5fdm0uZGF0ZVRpbWVGb3JtYXRzW2xvY2FsZV0gfHwge30pOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUuc2V0RGF0ZVRpbWVGb3JtYXQgPSBmdW5jdGlvbiBzZXREYXRlVGltZUZvcm1hdChsb2NhbGUsIGZvcm1hdCkgewogIHRoaXMuX3ZtLiRzZXQodGhpcy5fdm0uZGF0ZVRpbWVGb3JtYXRzLCBsb2NhbGUsIGZvcm1hdCk7CgogIHRoaXMuX2NsZWFyRGF0ZVRpbWVGb3JtYXQobG9jYWxlLCBmb3JtYXQpOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUubWVyZ2VEYXRlVGltZUZvcm1hdCA9IGZ1bmN0aW9uIG1lcmdlRGF0ZVRpbWVGb3JtYXQobG9jYWxlLCBmb3JtYXQpIHsKICB0aGlzLl92bS4kc2V0KHRoaXMuX3ZtLmRhdGVUaW1lRm9ybWF0cywgbG9jYWxlLCBtZXJnZSh0aGlzLl92bS5kYXRlVGltZUZvcm1hdHNbbG9jYWxlXSB8fCB7fSwgZm9ybWF0KSk7CgogIHRoaXMuX2NsZWFyRGF0ZVRpbWVGb3JtYXQobG9jYWxlLCBmb3JtYXQpOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX2NsZWFyRGF0ZVRpbWVGb3JtYXQgPSBmdW5jdGlvbiBfY2xlYXJEYXRlVGltZUZvcm1hdChsb2NhbGUsIGZvcm1hdCkgewogIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1hdXRvZml4L3ByZWZlci1jb25zdAogIGZvciAodmFyIGtleSBpbiBmb3JtYXQpIHsKICAgIHZhciBpZCA9IGxvY2FsZSArICJfXyIgKyBrZXk7CgogICAgaWYgKCF0aGlzLl9kYXRlVGltZUZvcm1hdHRlcnMuaGFzT3duUHJvcGVydHkoaWQpKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQoKICAgIGRlbGV0ZSB0aGlzLl9kYXRlVGltZUZvcm1hdHRlcnNbaWRdOwogIH0KfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl9sb2NhbGl6ZURhdGVUaW1lID0gZnVuY3Rpb24gX2xvY2FsaXplRGF0ZVRpbWUodmFsdWUsIGxvY2FsZSwgZmFsbGJhY2ssIGRhdGVUaW1lRm9ybWF0cywga2V5KSB7CiAgdmFyIF9sb2NhbGUgPSBsb2NhbGU7CiAgdmFyIGZvcm1hdHMgPSBkYXRlVGltZUZvcm1hdHNbX2xvY2FsZV07CgogIHZhciBjaGFpbiA9IHRoaXMuX2dldExvY2FsZUNoYWluKGxvY2FsZSwgZmFsbGJhY2spOwoKICBmb3IgKHZhciBpID0gMDsgaSA8IGNoYWluLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgY3VycmVudCA9IF9sb2NhbGU7CiAgICB2YXIgc3RlcCA9IGNoYWluW2ldOwogICAgZm9ybWF0cyA9IGRhdGVUaW1lRm9ybWF0c1tzdGVwXTsKICAgIF9sb2NhbGUgPSBzdGVwOyAvLyBmYWxsYmFjayBsb2NhbGUKCiAgICBpZiAoaXNOdWxsKGZvcm1hdHMpIHx8IGlzTnVsbChmb3JtYXRzW2tleV0pKSB7CiAgICAgIGlmIChzdGVwICE9PSBsb2NhbGUgJiYgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyAmJiAhdGhpcy5faXNTaWxlbnRUcmFuc2xhdGlvbldhcm4oa2V5KSAmJiAhdGhpcy5faXNTaWxlbnRGYWxsYmFja1dhcm4oa2V5KSkgewogICAgICAgIHdhcm4oIkZhbGwgYmFjayB0byAnIiArIHN0ZXAgKyAiJyBkYXRldGltZSBmb3JtYXRzIGZyb20gJyIgKyBjdXJyZW50ICsgIicgZGF0ZXRpbWUgZm9ybWF0cy4iKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgYnJlYWs7CiAgICB9CiAgfQoKICBpZiAoaXNOdWxsKGZvcm1hdHMpIHx8IGlzTnVsbChmb3JtYXRzW2tleV0pKSB7CiAgICByZXR1cm4gbnVsbDsKICB9IGVsc2UgewogICAgdmFyIGZvcm1hdCA9IGZvcm1hdHNba2V5XTsKICAgIHZhciBpZCA9IF9sb2NhbGUgKyAiX18iICsga2V5OwogICAgdmFyIGZvcm1hdHRlciA9IHRoaXMuX2RhdGVUaW1lRm9ybWF0dGVyc1tpZF07CgogICAgaWYgKCFmb3JtYXR0ZXIpIHsKICAgICAgZm9ybWF0dGVyID0gdGhpcy5fZGF0ZVRpbWVGb3JtYXR0ZXJzW2lkXSA9IG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KF9sb2NhbGUsIGZvcm1hdCk7CiAgICB9CgogICAgcmV0dXJuIGZvcm1hdHRlci5mb3JtYXQodmFsdWUpOwogIH0KfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl9kID0gZnVuY3Rpb24gX2QodmFsdWUsIGxvY2FsZSwga2V5KSB7CiAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiYgIVZ1ZUkxOG4uYXZhaWxhYmlsaXRpZXMuZGF0ZVRpbWVGb3JtYXQpIHsKICAgIHdhcm4oJ0Nhbm5vdCBmb3JtYXQgYSBEYXRlIHZhbHVlIGR1ZSB0byBub3Qgc3VwcG9ydGVkIEludGwuRGF0ZVRpbWVGb3JtYXQuJyk7CiAgICByZXR1cm4gJyc7CiAgfQoKICBpZiAoIWtleSkgewogICAgcmV0dXJuIG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KGxvY2FsZSkuZm9ybWF0KHZhbHVlKTsKICB9CgogIHZhciByZXQgPSB0aGlzLl9sb2NhbGl6ZURhdGVUaW1lKHZhbHVlLCBsb2NhbGUsIHRoaXMuZmFsbGJhY2tMb2NhbGUsIHRoaXMuX2dldERhdGVUaW1lRm9ybWF0cygpLCBrZXkpOwoKICBpZiAodGhpcy5faXNGYWxsYmFja1Jvb3QocmV0KSkgewogICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiYgIXRoaXMuX2lzU2lsZW50VHJhbnNsYXRpb25XYXJuKGtleSkgJiYgIXRoaXMuX2lzU2lsZW50RmFsbGJhY2tXYXJuKGtleSkpIHsKICAgICAgd2FybigiRmFsbCBiYWNrIHRvIGRhdGV0aW1lIGxvY2FsaXphdGlvbiBvZiByb290OiBrZXkgJyIgKyBrZXkgKyAiJy4iKTsKICAgIH0KICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwoKCiAgICBpZiAoIXRoaXMuX3Jvb3QpIHsKICAgICAgdGhyb3cgRXJyb3IoJ3VuZXhwZWN0ZWQgZXJyb3InKTsKICAgIH0KCiAgICByZXR1cm4gdGhpcy5fcm9vdC4kaTE4bi5kKHZhbHVlLCBrZXksIGxvY2FsZSk7CiAgfSBlbHNlIHsKICAgIHJldHVybiByZXQgfHwgJyc7CiAgfQp9OwoKVnVlSTE4bi5wcm90b3R5cGUuZCA9IGZ1bmN0aW9uIGQodmFsdWUpIHsKICB2YXIgYXJncyA9IFtdLAogICAgICBsZW4gPSBhcmd1bWVudHMubGVuZ3RoIC0gMTsKCiAgd2hpbGUgKGxlbi0tID4gMCkgYXJnc1tsZW5dID0gYXJndW1lbnRzW2xlbiArIDFdOwoKICB2YXIgbG9jYWxlID0gdGhpcy5sb2NhbGU7CiAgdmFyIGtleSA9IG51bGw7CgogIGlmIChhcmdzLmxlbmd0aCA9PT0gMSkgewogICAgaWYgKGlzU3RyaW5nKGFyZ3NbMF0pKSB7CiAgICAgIGtleSA9IGFyZ3NbMF07CiAgICB9IGVsc2UgaWYgKGlzT2JqZWN0KGFyZ3NbMF0pKSB7CiAgICAgIGlmIChhcmdzWzBdLmxvY2FsZSkgewogICAgICAgIGxvY2FsZSA9IGFyZ3NbMF0ubG9jYWxlOwogICAgICB9CgogICAgICBpZiAoYXJnc1swXS5rZXkpIHsKICAgICAgICBrZXkgPSBhcmdzWzBdLmtleTsKICAgICAgfQogICAgfQogIH0gZWxzZSBpZiAoYXJncy5sZW5ndGggPT09IDIpIHsKICAgIGlmIChpc1N0cmluZyhhcmdzWzBdKSkgewogICAgICBrZXkgPSBhcmdzWzBdOwogICAgfQoKICAgIGlmIChpc1N0cmluZyhhcmdzWzFdKSkgewogICAgICBsb2NhbGUgPSBhcmdzWzFdOwogICAgfQogIH0KCiAgcmV0dXJuIHRoaXMuX2QodmFsdWUsIGxvY2FsZSwga2V5KTsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLmdldE51bWJlckZvcm1hdCA9IGZ1bmN0aW9uIGdldE51bWJlckZvcm1hdChsb2NhbGUpIHsKICByZXR1cm4gbG9vc2VDbG9uZSh0aGlzLl92bS5udW1iZXJGb3JtYXRzW2xvY2FsZV0gfHwge30pOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUuc2V0TnVtYmVyRm9ybWF0ID0gZnVuY3Rpb24gc2V0TnVtYmVyRm9ybWF0KGxvY2FsZSwgZm9ybWF0KSB7CiAgdGhpcy5fdm0uJHNldCh0aGlzLl92bS5udW1iZXJGb3JtYXRzLCBsb2NhbGUsIGZvcm1hdCk7CgogIHRoaXMuX2NsZWFyTnVtYmVyRm9ybWF0KGxvY2FsZSwgZm9ybWF0KTsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLm1lcmdlTnVtYmVyRm9ybWF0ID0gZnVuY3Rpb24gbWVyZ2VOdW1iZXJGb3JtYXQobG9jYWxlLCBmb3JtYXQpIHsKICB0aGlzLl92bS4kc2V0KHRoaXMuX3ZtLm51bWJlckZvcm1hdHMsIGxvY2FsZSwgbWVyZ2UodGhpcy5fdm0ubnVtYmVyRm9ybWF0c1tsb2NhbGVdIHx8IHt9LCBmb3JtYXQpKTsKCiAgdGhpcy5fY2xlYXJOdW1iZXJGb3JtYXQobG9jYWxlLCBmb3JtYXQpOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX2NsZWFyTnVtYmVyRm9ybWF0ID0gZnVuY3Rpb24gX2NsZWFyTnVtYmVyRm9ybWF0KGxvY2FsZSwgZm9ybWF0KSB7CiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWF1dG9maXgvcHJlZmVyLWNvbnN0CiAgZm9yICh2YXIga2V5IGluIGZvcm1hdCkgewogICAgdmFyIGlkID0gbG9jYWxlICsgIl9fIiArIGtleTsKCiAgICBpZiAoIXRoaXMuX251bWJlckZvcm1hdHRlcnMuaGFzT3duUHJvcGVydHkoaWQpKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQoKICAgIGRlbGV0ZSB0aGlzLl9udW1iZXJGb3JtYXR0ZXJzW2lkXTsKICB9Cn07CgpWdWVJMThuLnByb3RvdHlwZS5fZ2V0TnVtYmVyRm9ybWF0dGVyID0gZnVuY3Rpb24gX2dldE51bWJlckZvcm1hdHRlcih2YWx1ZSwgbG9jYWxlLCBmYWxsYmFjaywgbnVtYmVyRm9ybWF0cywga2V5LCBvcHRpb25zKSB7CiAgdmFyIF9sb2NhbGUgPSBsb2NhbGU7CiAgdmFyIGZvcm1hdHMgPSBudW1iZXJGb3JtYXRzW19sb2NhbGVdOwoKICB2YXIgY2hhaW4gPSB0aGlzLl9nZXRMb2NhbGVDaGFpbihsb2NhbGUsIGZhbGxiYWNrKTsKCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGFpbi5sZW5ndGg7IGkrKykgewogICAgdmFyIGN1cnJlbnQgPSBfbG9jYWxlOwogICAgdmFyIHN0ZXAgPSBjaGFpbltpXTsKICAgIGZvcm1hdHMgPSBudW1iZXJGb3JtYXRzW3N0ZXBdOwogICAgX2xvY2FsZSA9IHN0ZXA7IC8vIGZhbGxiYWNrIGxvY2FsZQoKICAgIGlmIChpc051bGwoZm9ybWF0cykgfHwgaXNOdWxsKGZvcm1hdHNba2V5XSkpIHsKICAgICAgaWYgKHN0ZXAgIT09IGxvY2FsZSAmJiBwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nICYmICF0aGlzLl9pc1NpbGVudFRyYW5zbGF0aW9uV2FybihrZXkpICYmICF0aGlzLl9pc1NpbGVudEZhbGxiYWNrV2FybihrZXkpKSB7CiAgICAgICAgd2FybigiRmFsbCBiYWNrIHRvICciICsgc3RlcCArICInIG51bWJlciBmb3JtYXRzIGZyb20gJyIgKyBjdXJyZW50ICsgIicgbnVtYmVyIGZvcm1hdHMuIik7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGJyZWFrOwogICAgfQogIH0KCiAgaWYgKGlzTnVsbChmb3JtYXRzKSB8fCBpc051bGwoZm9ybWF0c1trZXldKSkgewogICAgcmV0dXJuIG51bGw7CiAgfSBlbHNlIHsKICAgIHZhciBmb3JtYXQgPSBmb3JtYXRzW2tleV07CiAgICB2YXIgZm9ybWF0dGVyOwoKICAgIGlmIChvcHRpb25zKSB7CiAgICAgIC8vIElmIG9wdGlvbnMgc3BlY2lmaWVkIC0gY3JlYXRlIG9uZSB0aW1lIG51bWJlciBmb3JtYXR0ZXIKICAgICAgZm9ybWF0dGVyID0gbmV3IEludGwuTnVtYmVyRm9ybWF0KF9sb2NhbGUsIE9iamVjdC5hc3NpZ24oe30sIGZvcm1hdCwgb3B0aW9ucykpOwogICAgfSBlbHNlIHsKICAgICAgdmFyIGlkID0gX2xvY2FsZSArICJfXyIgKyBrZXk7CiAgICAgIGZvcm1hdHRlciA9IHRoaXMuX251bWJlckZvcm1hdHRlcnNbaWRdOwoKICAgICAgaWYgKCFmb3JtYXR0ZXIpIHsKICAgICAgICBmb3JtYXR0ZXIgPSB0aGlzLl9udW1iZXJGb3JtYXR0ZXJzW2lkXSA9IG5ldyBJbnRsLk51bWJlckZvcm1hdChfbG9jYWxlLCBmb3JtYXQpOwogICAgICB9CiAgICB9CgogICAgcmV0dXJuIGZvcm1hdHRlcjsKICB9Cn07CgpWdWVJMThuLnByb3RvdHlwZS5fbiA9IGZ1bmN0aW9uIF9uKHZhbHVlLCBsb2NhbGUsIGtleSwgb3B0aW9ucykgewogIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogIGlmICghVnVlSTE4bi5hdmFpbGFiaWxpdGllcy5udW1iZXJGb3JtYXQpIHsKICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAgIHdhcm4oJ0Nhbm5vdCBmb3JtYXQgYSBOdW1iZXIgdmFsdWUgZHVlIHRvIG5vdCBzdXBwb3J0ZWQgSW50bC5OdW1iZXJGb3JtYXQuJyk7CiAgICB9CgogICAgcmV0dXJuICcnOwogIH0KCiAgaWYgKCFrZXkpIHsKICAgIHZhciBuZiA9ICFvcHRpb25zID8gbmV3IEludGwuTnVtYmVyRm9ybWF0KGxvY2FsZSkgOiBuZXcgSW50bC5OdW1iZXJGb3JtYXQobG9jYWxlLCBvcHRpb25zKTsKICAgIHJldHVybiBuZi5mb3JtYXQodmFsdWUpOwogIH0KCiAgdmFyIGZvcm1hdHRlciA9IHRoaXMuX2dldE51bWJlckZvcm1hdHRlcih2YWx1ZSwgbG9jYWxlLCB0aGlzLmZhbGxiYWNrTG9jYWxlLCB0aGlzLl9nZXROdW1iZXJGb3JtYXRzKCksIGtleSwgb3B0aW9ucyk7CgogIHZhciByZXQgPSBmb3JtYXR0ZXIgJiYgZm9ybWF0dGVyLmZvcm1hdCh2YWx1ZSk7CgogIGlmICh0aGlzLl9pc0ZhbGxiYWNrUm9vdChyZXQpKSB7CiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyAmJiAhdGhpcy5faXNTaWxlbnRUcmFuc2xhdGlvbldhcm4oa2V5KSAmJiAhdGhpcy5faXNTaWxlbnRGYWxsYmFja1dhcm4oa2V5KSkgewogICAgICB3YXJuKCJGYWxsIGJhY2sgdG8gbnVtYmVyIGxvY2FsaXphdGlvbiBvZiByb290OiBrZXkgJyIgKyBrZXkgKyAiJy4iKTsKICAgIH0KICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwoKCiAgICBpZiAoIXRoaXMuX3Jvb3QpIHsKICAgICAgdGhyb3cgRXJyb3IoJ3VuZXhwZWN0ZWQgZXJyb3InKTsKICAgIH0KCiAgICByZXR1cm4gdGhpcy5fcm9vdC4kaTE4bi5uKHZhbHVlLCBPYmplY3QuYXNzaWduKHt9LCB7CiAgICAgIGtleToga2V5LAogICAgICBsb2NhbGU6IGxvY2FsZQogICAgfSwgb3B0aW9ucykpOwogIH0gZWxzZSB7CiAgICByZXR1cm4gcmV0IHx8ICcnOwogIH0KfTsKClZ1ZUkxOG4ucHJvdG90eXBlLm4gPSBmdW5jdGlvbiBuKHZhbHVlKSB7CiAgdmFyIGFyZ3MgPSBbXSwKICAgICAgbGVuID0gYXJndW1lbnRzLmxlbmd0aCAtIDE7CgogIHdoaWxlIChsZW4tLSA+IDApIGFyZ3NbbGVuXSA9IGFyZ3VtZW50c1tsZW4gKyAxXTsKCiAgdmFyIGxvY2FsZSA9IHRoaXMubG9jYWxlOwogIHZhciBrZXkgPSBudWxsOwogIHZhciBvcHRpb25zID0gbnVsbDsKCiAgaWYgKGFyZ3MubGVuZ3RoID09PSAxKSB7CiAgICBpZiAoaXNTdHJpbmcoYXJnc1swXSkpIHsKICAgICAga2V5ID0gYXJnc1swXTsKICAgIH0gZWxzZSBpZiAoaXNPYmplY3QoYXJnc1swXSkpIHsKICAgICAgaWYgKGFyZ3NbMF0ubG9jYWxlKSB7CiAgICAgICAgbG9jYWxlID0gYXJnc1swXS5sb2NhbGU7CiAgICAgIH0KCiAgICAgIGlmIChhcmdzWzBdLmtleSkgewogICAgICAgIGtleSA9IGFyZ3NbMF0ua2V5OwogICAgICB9IC8vIEZpbHRlciBvdXQgbnVtYmVyIGZvcm1hdCBvcHRpb25zIG9ubHkKCgogICAgICBvcHRpb25zID0gT2JqZWN0LmtleXMoYXJnc1swXSkucmVkdWNlKGZ1bmN0aW9uIChhY2MsIGtleSkgewogICAgICAgIHZhciBvYmo7CgogICAgICAgIGlmIChpbmNsdWRlcyhudW1iZXJGb3JtYXRLZXlzLCBrZXkpKSB7CiAgICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih7fSwgYWNjLCAob2JqID0ge30sIG9ialtrZXldID0gYXJnc1swXVtrZXldLCBvYmopKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBhY2M7CiAgICAgIH0sIG51bGwpOwogICAgfQogIH0gZWxzZSBpZiAoYXJncy5sZW5ndGggPT09IDIpIHsKICAgIGlmIChpc1N0cmluZyhhcmdzWzBdKSkgewogICAgICBrZXkgPSBhcmdzWzBdOwogICAgfQoKICAgIGlmIChpc1N0cmluZyhhcmdzWzFdKSkgewogICAgICBsb2NhbGUgPSBhcmdzWzFdOwogICAgfQogIH0KCiAgcmV0dXJuIHRoaXMuX24odmFsdWUsIGxvY2FsZSwga2V5LCBvcHRpb25zKTsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl9udHAgPSBmdW5jdGlvbiBfbnRwKHZhbHVlLCBsb2NhbGUsIGtleSwgb3B0aW9ucykgewogIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogIGlmICghVnVlSTE4bi5hdmFpbGFiaWxpdGllcy5udW1iZXJGb3JtYXQpIHsKICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAgIHdhcm4oJ0Nhbm5vdCBmb3JtYXQgdG8gcGFydHMgYSBOdW1iZXIgdmFsdWUgZHVlIHRvIG5vdCBzdXBwb3J0ZWQgSW50bC5OdW1iZXJGb3JtYXQuJyk7CiAgICB9CgogICAgcmV0dXJuIFtdOwogIH0KCiAgaWYgKCFrZXkpIHsKICAgIHZhciBuZiA9ICFvcHRpb25zID8gbmV3IEludGwuTnVtYmVyRm9ybWF0KGxvY2FsZSkgOiBuZXcgSW50bC5OdW1iZXJGb3JtYXQobG9jYWxlLCBvcHRpb25zKTsKICAgIHJldHVybiBuZi5mb3JtYXRUb1BhcnRzKHZhbHVlKTsKICB9CgogIHZhciBmb3JtYXR0ZXIgPSB0aGlzLl9nZXROdW1iZXJGb3JtYXR0ZXIodmFsdWUsIGxvY2FsZSwgdGhpcy5mYWxsYmFja0xvY2FsZSwgdGhpcy5fZ2V0TnVtYmVyRm9ybWF0cygpLCBrZXksIG9wdGlvbnMpOwoKICB2YXIgcmV0ID0gZm9ybWF0dGVyICYmIGZvcm1hdHRlci5mb3JtYXRUb1BhcnRzKHZhbHVlKTsKCiAgaWYgKHRoaXMuX2lzRmFsbGJhY2tSb290KHJldCkpIHsKICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nICYmICF0aGlzLl9pc1NpbGVudFRyYW5zbGF0aW9uV2FybihrZXkpKSB7CiAgICAgIHdhcm4oIkZhbGwgYmFjayB0byBmb3JtYXQgbnVtYmVyIHRvIHBhcnRzIG9mIHJvb3Q6IGtleSAnIiArIGtleSArICInIC4iKTsKICAgIH0KICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwoKCiAgICBpZiAoIXRoaXMuX3Jvb3QpIHsKICAgICAgdGhyb3cgRXJyb3IoJ3VuZXhwZWN0ZWQgZXJyb3InKTsKICAgIH0KCiAgICByZXR1cm4gdGhpcy5fcm9vdC4kaTE4bi5fbnRwKHZhbHVlLCBsb2NhbGUsIGtleSwgb3B0aW9ucyk7CiAgfSBlbHNlIHsKICAgIHJldHVybiByZXQgfHwgW107CiAgfQp9OwoKT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoVnVlSTE4bi5wcm90b3R5cGUsIHByb3RvdHlwZUFjY2Vzc29ycyk7CnZhciBhdmFpbGFiaWxpdGllczsgLy8gJEZsb3dGaXhNZQoKT2JqZWN0LmRlZmluZVByb3BlcnR5KFZ1ZUkxOG4sICdhdmFpbGFiaWxpdGllcycsIHsKICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgIGlmICghYXZhaWxhYmlsaXRpZXMpIHsKICAgICAgdmFyIGludGxEZWZpbmVkID0gdHlwZW9mIEludGwgIT09ICd1bmRlZmluZWQnOwogICAgICBhdmFpbGFiaWxpdGllcyA9IHsKICAgICAgICBkYXRlVGltZUZvcm1hdDogaW50bERlZmluZWQgJiYgdHlwZW9mIEludGwuRGF0ZVRpbWVGb3JtYXQgIT09ICd1bmRlZmluZWQnLAogICAgICAgIG51bWJlckZvcm1hdDogaW50bERlZmluZWQgJiYgdHlwZW9mIEludGwuTnVtYmVyRm9ybWF0ICE9PSAndW5kZWZpbmVkJwogICAgICB9OwogICAgfQoKICAgIHJldHVybiBhdmFpbGFiaWxpdGllczsKICB9Cn0pOwpWdWVJMThuLmluc3RhbGwgPSBpbnN0YWxsOwpWdWVJMThuLnZlcnNpb24gPSAnOC4yNy4yJzsKZXhwb3J0IGRlZmF1bHQgVnVlSTE4bjs="},null]}